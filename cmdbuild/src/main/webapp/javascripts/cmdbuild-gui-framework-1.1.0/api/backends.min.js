!function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.processInstanceId=i.cardId,this.processActivityId=i.activityInstanceId,this.data=[],this.metadata={},this.widgets=void 0;var a=a,s=s;this.updateData=function(i,a){for(var s={},e=0;e<this.attributes.length;e++)s[this.attributes[e]._id]=i.data[this.attributes[e]._id];s._advance="true"==i.advance,s._activity=this.processActivityId[0],t.Cmdbuild.utilities.proxy.putStepProcess(this.type,this.processInstanceId,s,a,this)},this.init=function(){this.loadAttributes()},this.loadAttributes=function(){this.attributes=[{type:"title",name:"title"},{type:"paragraph",name:"help"}],this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.data.activityTitle=this.activityTitle,this.metadata=i,e()},this.loadData=function(){t.Cmdbuild.utilities.proxy.getCardData(this.type,this.param.cardId,{},this.loadDataCallback,this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.ActivityHelp=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.processInstanceId=i.cardId,this.processActivityId=i.activityInstanceId,this.displayFirstAvailableActivity=i.displayFirstAvailableActivity,this.hideActivityTitle=i.hideActivityTitle,this.data=[],this.metadata={},this.widgets=void 0,this.widgetsData=[],this.originalAttributes=[];var a=a,s=s;this.deleteMail=function(t){for(var i=0;i<this.data.mails.length;i++){var a=this.data.mails[i];a._id===t.cardId&&this.data.mails.splice(i,1)}},this.updateData=function(i,a){for(var s={},e=0;e<this.attributes.length;e++)s[this.attributes[e]._id]=i.data[this.attributes[e]._id];s._advance="true"==i.advance,"object"==typeof this.processActivityId&&(this.processActivityId=this.processActivityId[0]),s._activity=this.processActivityId,this.widgetsData=t.Cmdbuild.widgets.getWidgetsData(i.form,this.widgets),t.Cmdbuild.widgets.saveOnDataWidgets(s,this.widgetsData),t.Cmdbuild.utilities.proxy.putStepProcess(this.type,this.processInstanceId,s,function(s){t.Cmdbuild.utilities.proxy.getCardProcess(this.type,this.processInstanceId,{},function(s){t.Cmdbuild.widgets.savePostponedWidgets(this.widgets,this.widgetsData,{type:this.type,id:this.processInstanceId},i.form,function(){a(s)},this)},this)},this)},this.init=function(){this.loadAttributes()},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return t.Cmdbuild.errorsManager.warn(a),void(this.attributes=[])}t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.originalAttributes=i.slice(),this.processWithActivity=!0,this.processActivityId?(this.classAttributes=i,t.Cmdbuild.utilities.proxy.getStepProcessAttributes(this.type,this.processInstanceId,this.processActivityId,this.loadProcessStepAttributes,this)):this.displayFirstAvailableActivity?(this.classAttributes=i,t.Cmdbuild.utilities.proxy.getActivity(this.type,this.processInstanceId,this.onActivitiesLoaded,this)):(this.processWithActivity=!1,this.attributes=i,this.loadData())},this.onActivitiesLoaded=function(i){i.length?(this.processActivityId=i[0]._id,t.Cmdbuild.utilities.proxy.getStepProcessAttributes(this.type,this.processInstanceId,this.processActivityId,this.loadProcessStepAttributes,this)):(this.attributes=this.classAttributes,this.loadData())},this.loadProcessStepAttributes=function(i){this.activityTitle=i.description,this.activityAttributes=i.attributes,this.originalAttributes.concat(i.attributes.slice()),this.attributes=[],this.hideActivityTitle||this.attributes.push({type:"title",displayableInList:!1,active:!0,name:"activityTitle",index:-1});for(var a=0;a<this.classAttributes.length;a++)for(var s=0;s<+this.activityAttributes.length;s++)if(this.classAttributes[a]._id==this.activityAttributes[s]._id){var e=this.activityAttributes[s];this.classAttributes[a].mandatory=e.mandatory,this.classAttributes[a].writable=e.writable,this.classAttributes[a].index=e.index,this.attributes.push(this.classAttributes[a])}t.Cmdbuild.utilities.changeAttributeType(this.attributes,"Notes","text"),this.widgets=i.widgets,this.loadData()},this.loadDataCallback=function(t,i){this.data=t,this.data.activityTitle=this.activityTitle,this.data.advanceEnabled=this.processWithActivity,this.data.readOnly=!this.processWithActivity,this.metadata=i,e()},this.loadData=function(){t.Cmdbuild.utilities.proxy.getCardProcess(this.type,this.param.cardId,{},this.loadDataCallback,this)},this.getAttributes=function(){function t(t,i){return t.index<i.index?-1:t.index>i.index?1:0}return this.attributes.sort(t),this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.getOriginalAttributes=function(){return this.originalAttributes};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Activity=i}(jQuery),function(t){var i=function(i,a,s){this.type=i.className,this.data=[],this.metadata={},this.listData=[],this.typeFilter="attribute",this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i),this.positionOf=i.positionOf,this.positions={},this.defaultSort=i.sort,this.defaultDirection=i.direction,i.noUser||this.conditions.push({field:i.paramUser,value:i.user}),this.cqlfilter=i.cqlFilter,this.cqlfilterFn=i.cqlFilterFn,this.filter={},this.setFilter=function(i){var a=this.filter.CQL,s=this.conditions.slice();i.flowStatus&&void 0!==i.flowStatus&&s.push({field:"_status",value:i.flowStatus});var e=t.Cmdbuild.utilities.getAttributesFilterFromConditions(s);this.filter.attribute=e,this.cqlfilter?(this.filter.CQL=this.cqlfilter,this.noValidFilter=!1):this.cqlfilterFn?(this.noValidFilter=!1,this.filter.CQL=this.cqlfilterFn.apply()):this.filter.CQL=a},this.updateFilter=function(){this.cqlfilterFn&&(this.filter.CQL=this.cqlfilterFn.apply())},this.getStatus=function(){return this.flowStatus};var a=a,s=s;this.deleteRow=function(i,a){var s=t.Cmdbuild.dataModel.getValues(i.form);t.Cmdbuild.utilities.proxy.abortProcess(s._type,s._id,{},function(t){a(t)},this)},this.init=function(){t.Cmdbuild.utilities.proxy.getProcessStatuses(function(a){this.flowStatuses=a,t.Cmdbuild.utilities.proxy.getProcess(this.type,function(t){i.flowStatus?this.setFilter({flowStatus:t.defaultStatus}):this.setFilter({}),this.loadAttributes()},this)},this)},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return void t.Cmdbuild.errorsManager.warn(a)}t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,this.positionOf?this.loadPositions():e()},this.loadPositions=function(){var t=this;this.updateFilter();var i={sort:this.defaultSort,direction:this.defaultDirection||"ASC",positionOf:this.positionOf,filter:this.filter};this.makeAjaxRequest(i,function(){t.positions=t.metadata.positions,t.data=[],t.metadata={},e()},this)},this.loadData=function(t,i,a){if(this.noValidFilter)return this.data=[],void i.apply(a,this.data);this.updateFilter();var s={page:t.currentPage,start:t.firstRow,limit:t.nRows,sort:t.sort,direction:t.direction,filter:this.filter,active:!0},e=function(){this.expandData(i,a)};this.makeAjaxRequest(s,e,this)},this.makeAjaxRequest=function(i,a,s){t.Cmdbuild.utilities.proxy.getActivityList(this.type,i,function(t,i){this.data=[],this.listData=t,this.metadata=i,a.apply(s,this.data)},this)},this.expandData=function(i,a){if(0==this.listData.length)return void i.apply(a,this.data);var s=this.listData[0];this.listData.splice(0,1),t.Cmdbuild.utilities.proxy.getActivity(s._type,s._id,function(e){if(0==e.length)s.writable=!1,this.data.push(s);else for(var r=0;r<e.length;r++){var n=t.Cmdbuild.utilities.clone(s);n.ActivityInstanceId=e[r]._id,n.activityTitle=e[r].description,n.writable=e[r].writable,this.data.push(n)}this.expandData(i,a)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.getStatus=function(){return this.flowStatus},this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.ActivityList=i}(jQuery),function(t){var i=[{type:"string",name:"_description",description:"Descrizione",displayableInList:!0,active:!0},{type:"string",name:"_name",description:"Nome file",displayableInList:!0,active:!0},{type:"string",name:"_author",description:"Autore",displayableInList:!0,active:!0},{type:"string",name:"_category",description:"Categoria",displayableInList:!0,active:!0},{type:"string",name:"_version",description:"Versione",displayableInList:!0,active:!0}],a=function(a,s,e){this.param=a,this.type=a.className,this.procId=a.cardId,this.data=[],this.metadata={},this.attributes=[];var s=s,e=e;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){this.attributes=i.slice(),setTimeout(function(){r()},500)},this.loadData=function(i,a,s){var e={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter},r=function(t,i){this.data=t,this.metadata=i,a.apply(s,this.data)};t.Cmdbuild.dataModel.isAClass(this.type)?t.Cmdbuild.utilities.proxy.getCardAttachments(this.type,this.procId,e,r,this):t.Cmdbuild.dataModel.isAProcess(this.type)&&t.Cmdbuild.utilities.proxy.getInstanceAttachment(this.type,this.procId,e,r,this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var r=function(){s.apply(e)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.Attachments=a,t.Cmdbuild.standard.backend.ProcessAttachments=function(){t.Cmdbuild.errorsManager.error("ProcessAttachments backend was removed. Please use Attachments backend.")}}(jQuery),function(t){var i=[{type:"string",name:"document",description:"Documento"},{type:"string",name:"description",description:"Descrizione"},{type:"string",name:"category",description:"Category"}],a=function(a,s,e){this.type=a.className,this.data=[],this.attributes=[],e.backend=this;var s=s,e=e;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){for(var t=0;t<i.length;t++)this.attributes.push({type:i[t].type,displayableInList:!0,active:!0,name:i[t].name,description:i[t].description});r()},this.loadData=function(i,a,s){var e=t.Cmdbuild.dataModel.getAttachmentsForWidget(i.form).slice();e?this.data=e:this.data=[],a.apply(s,this.data)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var r=function(){s.apply(e)};this.getTotalRows=function(){return this.getData().length},this.deleteRow=function(i){var a=t.Cmdbuild.dataModel.getCurrentIndex(i.form);this.data.splice(a,1),t.Cmdbuild.dataModel.setAttachmentsForWidget(i.form,this.data),t.Cmdbuild.standard.grid.onNavigate("begin",i.form)},this.addRow=function(i){this.data.splice(0,0,i.row),t.Cmdbuild.dataModel.setAttachmentsForWidget(i.form,this.data),t.Cmdbuild.standard.grid.onNavigate("begin",i.form)},this.init()};t.Cmdbuild.standard.backend.AttachmentsWidget=a}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){this.loadAttributes()},this.newData=function(i,a){for(var s={},e=0;e<this.attributes.length;e++)s[this.attributes[e]._id]=i.data[this.attributes[e]._id];t.Cmdbuild.utilities.proxy.postNewCard(this.type,s,a,this)},this.updateData=function(i,a){var s={};if(!this.data._id)return void this.newData(i,a);for(var e=0;e<this.attributes.length;e++)s[this.attributes[e]._id]=i.data[this.attributes[e]._id];t.Cmdbuild.utilities.proxy.putCard(this.type,this.data._id,s,a,this)},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return t.Cmdbuild.errorsManager.warn(a),void(this.attributes=[])}t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.originalAttributes=i.slice(),"true"!=this.param.withNotes?this.attributes=t.Cmdbuild.utilities.removeAttribute(i,"Notes"):this.attributes=i,t.Cmdbuild.utilities.sortAttributes(i),t.Cmdbuild.utilities.changeAttributeType(this.attributes,"Notes","text"),this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,e()},this.loadData=function(){if(this.param.cardId)t.Cmdbuild.utilities.proxy.getCardData(this.type,this.param.cardId,{},this.loadDataCallback,this);else{for(var i=0;i<this.attributes.length;i++)this.data[this.attributes[i]._id]="";this.metadata={},e()}},this.getAttributes=function(){return this.attributes?this.attributes:[]},this.getData=function(){return this.data?this.data:[]},this.getMetadata=function(){return this.metadata},this.getOriginalAttributes=function(){return this.originalAttributes};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Card=i}(jQuery),function(t){var i=function(i,a,s){this.type=i.className,this.data=[],this.metadata={},this.filter={},this.positionOf=i.positionOf,this.positions={},this.defaultSort=i.sort,this.defaultDirection=i.direction,this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i),this.filter={},this.cqlFilter=i.cqlFilter,this.cqlFilterFn=i.cqlFilterFn,this.updateFilter=function(){var i=this.filter.query,a=this.filter.CQL;this.filter={};var s=t.Cmdbuild.utilities.getAttributesFilterFromConditions(this.conditions);s&&(this.filter.attribute=s),i&&(this.filter.query=i),this.cqlFilter?(this.filter.CQL=this.cqlFilter,this.noValidFilter=!1):this.cqlFilterFn?(this.filter.CQL=this.cqlFilterFn.apply(),this.noValidFilter=!1):this.filter.CQL=a},i.widgetId;var a=a,s=s;this.init=function(){this.loadAttributes()},this.deleteRow=function(i,a,s){var e=t.Cmdbuild.dataModel.getValues(i.form);t.Cmdbuild.utilities.proxy.deleteCard(e._type,e._id,function(){a.apply(s,[])},this)},this.loadAttributes=function(){if(!this.type){var a="No _type specified for form: "+i.form;return t.Cmdbuild.errorsManager.warn(a),void(this.attributes=[])}t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.attributes=i,this.attributes.sort(t.Cmdbuild.utilities.attributesSorter),this.positionOf?this.loadPositions():e()},this.loadPositions=function(){var t=this;this.updateFilter();var i={sort:this.defaultSort,direction:this.defaultDirection||"ASC",positionOf:this.positionOf,filter:this.filter};this.makeAjaxRequest(i,function(){t.positions=t.metadata.positions,t.data=[],t.metadata={},e()},this)},this.loadData=function(t,i,a){if(this.noValidFilter)return this.data=[],void i.apply(a,this.data);this.updateFilter();var s={page:t.currentPage,start:t.firstRow,limit:t.nRows,sort:t.sort,direction:t.direction,filter:this.filter};this.makeAjaxRequest(s,i,a)},this.makeAjaxRequest=function(i,a,s){t.Cmdbuild.utilities.proxy.getCardList(this.type,i,function(t,i){this.data=t,this.metadata=i,a.apply(s,this.data)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.CardList=i}(jQuery),function(t){var i=function(t,i,a){this.param=t,this.type=t.processName,this.data=[],this.metadata={};var i=i,a=a;this.init=function(){this.data=[{_id:"Hour_1",description:"1 Hour"},{_id:"Hour_2",description:"2 Hours"},{_id:"Hour_4",description:"4 Hours"},{_id:"Day_1",description:"1 Day"},{_id:"Day_2",description:"2 Days"},{_id:"Day_4",description:"4 Days"}];var t=this;this.TM=setTimeout(function(){s(),clearTimeout(t.TM)},500)},this.getData=function(){return this.data},this.getValue=function(){return this.flowStatus},this.getMetadata=function(){return this.metadata};var s=function(){i.apply(a)};this.init()};t.Cmdbuild.standard.backend.DelayTable=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.lookupName,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){this.loadAttributes(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,e()},this.loadAttributes=function(){this.loadData()},this.loadData=function(i,a){t.Cmdbuild.utilities.proxy.getAttachmentsCategories(this.loadDataCallback,this)},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.DmsCategory=i}(jQuery),function(t){var i=function(i,a,s){this.type=i.destinationClass,this.data=[],this.listData=[],this.metadata={},this.param=i;var a=a,s=s;this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i);var e=t.Cmdbuild.utilities.getAttributesFilterFromConditions(this.conditions);this.filter={},e&&(this.filter.attribute=e),i.sourceId=""+i.sourceId;for(var r=i.sourceId.split(","),n=[],d=0;d<r.length;d++)n.push({className:i.sourceClass,id:t.trim(r[d])});this.filter.relation=[{domain:i.domainName,source:i.destinationClass,destination:i.sourceClass,type:"oneof",direction:"_2"==i.domainDirection?"_1":"_2",cards:n}],this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,o()},this.loadData=function(i,a,s){if(this.noValidFilter)return this.data=[],void a.apply(s,this.data);var e={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter};this.data=[],t.Cmdbuild.utilities.proxy.getCardList(this.type,e,function(t,i){this.data=t,this.metadata=i,a.apply(s,this.data)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var o=function(){a.apply(s)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.DomainList=i}(jQuery),function(t){var i=function(i,a,s){this.type=i.destinationClass,this.data=[],this.listData=[],this.metadata={};var a=a,s=s;if(this.conditions=[],i.condition)for(var e=i.condition.split(","),r=0;r<e.length;r++){var n=e[r].split("="),d={field:n[0],value:n[1]};this.conditions.push(d)}this.conditions=t.Cmdbuild.utilities.getConditionsFromParam(i);var o=t.Cmdbuild.utilities.getAttributesFilterFromConditions(this.conditions);this.filter={},o&&(this.filter.attribute=o),this.filter.relation=[{domain:i.domainName,source:i.destinationClass,destination:i.sourceClass,type:"oneof",direction:"_2"==i.domainDirection?"_1":"_2",cards:[{className:i.sourceClass,id:i.sourceId}]}],this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getClassAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,h()},this.loadData=function(i,a,s){if(this.noValidFilter)return this.data=[],void a.apply(s,this.data);var e={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter,filterType:this.typeFilter};this.data=[],t.Cmdbuild.utilities.proxy.getActivityList(this.type,e,function(t,i){this.listData=t,this.metadata=i,this.expandData(a,s)},this)},this.expandData=function(i,a){if(0==this.listData.length)return void i.apply(a,this.data);var s=this.listData[0];this.listData.splice(0,1),t.Cmdbuild.utilities.proxy.getActivity(s._type,s._id,function(e){if(0==e.length)this.data.push(s);else for(var r=0;r<e.length;r++){var n=t.Cmdbuild.utilities.clone(s);n.ActivityInstanceId=e[r]._id,n.activityTitle=e[r].description,this.data.push(n)}this.expandData(i,a)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var h=function(){a.apply(s)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.DomainListOnProcesses=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.processInstanceId=void 0,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){t.Cmdbuild.utilities.proxy.getStartProcessActivities(this.type,this.processInstanceId,function(i){if(i.length>0){this.description=i[0].description;var a=i[0]._id;t.Cmdbuild.utilities.proxy.getStartProcessAttributes(this.type,a,function(t){this.instructions=t.instructions,this.attributes=[{type:"title",name:"title"},{type:"paragraph",name:"help"}],this.loadData(this.param)},this)}},this)},this.loadData=function(){this.data={title:this.description,help:this.instructions},e()},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.HelpNewActivity=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.lookupName,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){this.loadAttributes(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,e()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getLookupType(this.type,{},this.loadData,this)},this.loadData=function(i,a){t.Cmdbuild.utilities.proxy.getLookupData(this.type,{},this.loadDataCallback,this)},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Lookup=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.searchCard=function(t){var i=this.innerSearchCard(t);return"reply"==this.param.mailStatus?this.composeReplyMail(i):"new"==this.param.mailStatus?this.composeNewMail(i):i},this.composeReplyMail=function(i){return{_id:"newmail_"+t.Cmdbuild.utilities.uniqueId(),account:"default",to:i.from,from:i.to,body:i.from+"wrote: </br>"+i.body,subject:"R: "+i.subject}},this.composeNewMail=function(i){return{_id:"newmail_"+t.Cmdbuild.utilities.uniqueId(),account:"default",to:"",from:"default",body:"-----------",subject:"........."}},this.innerSearchCard=function(i){for(var a=t.Cmdbuild.dataModel.forms[this.param.formData],s=a.getBackendData().mails,e=0;e<s.length;e++){var r=s[e];if(r._id===i){var n=[];switch(r.status){case t.Cmdbuild.global.MAILSTATUSDRAFT:n=r.fromTemplate?["keepSynchronization","delay","account","from","to","bcc","subject","body"]:["delay","account","from","to","bcc","subject","body"];break;default:n=["account","from","to","bcc","subject","body"]}return this.loadAttributes(n,this.possibleAttributes),r}}},this.updateData=function(i,a,s){var e={};e._id=i.data._id;for(var r=0;r<this.attributes.length;r++)e[this.attributes[r].name]=i.data[this.attributes[r].name];if("reply"==this.param.mailStatus||"new"==this.param.mailStatus){var n=t.Cmdbuild.dataModel.forms[this.param.formData];e.status=t.Cmdbuild.global.MAILSTATUSDRAFT,n.getBackendData().mails.push(e)}a&&a.apply(s,[])},this.possibleAttributes=[{type:"boolean",name:"keepSynchronization",description:"keepSynchronization"},{type:"select",name:"delay",description:"Delay",backend:"DelayTable"},{type:"string",name:"account",description:"Account"},{type:"string",name:"from",description:"From"},{type:"string",name:"to",description:"To"},{type:"string",name:"bcc",description:"Bcc"},{type:"string",name:"subject",description:"Subject"},{type:"text",name:"body",description:"Body"}],this.replyTable={account:"to",body:"body",subject:"subject"};var a=a,s=s;this.init=function(){this.loadData()},this.loadData=function(){this.data=this.searchCard(this.param.cardId),e()},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.loadAttributes=function(t,i){this.attributes=[];for(var a=0;a<t.length;a++)for(var s=0;s<i.length;s++)if(t[a]==i[s].name){this.attributes.push(i[s]);break}};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Mail=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){this.loadAttributes(this.param)},this.loadAttributes=function(){this.attributes=[{type:"string",name:"status",description:"Status",displayableInList:!0},{type:"string",name:"to",description:"Addresses",displayableInList:!0},{type:"text",name:"subject",description:"Subject",displayableInList:!0}];var t=this;this.TM=setTimeout(function(){e(),clearTimeout(t.TM)},500)},this.loadData=function(i,a,s){var e=t.Cmdbuild.dataModel.forms[this.param.formData],r=e.getBackendData().mails;if("true"===this.param.onlyTemplates){this.data=[];for(var n=0;n<r.length;n++)r[n].fromTemplate&&this.data.push(r[n])}else this.data=r;this.data.sort(function(t,i){return t.status>=i.status?1:-1}),a.apply(s)},this.disableRowButtons=function(i){switch(this.data[i].status){case t.Cmdbuild.global.MAILSTATUSDRAFT:return this.data[i].fromTemplate?[]:[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE];case t.Cmdbuild.global.MAILSTATUSNEW:return[];case t.Cmdbuild.global.MAILSTATUSOUTGOING:return[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREPLY];case t.Cmdbuild.global.MAILSTATUSRECEIVED:return[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONMODIFY,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONDELETE];default:return[t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREGENERATE,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONREPLY,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONMODIFY,t.Cmdbuild.widgets.ManageEmail.ROWBUTTONDELETE]}},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata},this.getTotalRows=function(){return this.getData().length};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.MailList=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.processInstanceId=void 0,this.data=[],this.metadata={},this.widgets=void 0,this.widgetsData=[];var a=a,s=s;this.updateData=function(i,a){for(var s={},e=0;e<this.attributes.length;e++)s[this.attributes[e]._id]=i.data[this.attributes[e]._id];s._advance="true"==i.advance,this.widgetsData=t.Cmdbuild.widgets.getWidgetsData(i.form,this.widgets),t.Cmdbuild.widgets.saveOnDataWidgets(s,this.widgetsData);var r=this;t.Cmdbuild.utilities.proxy.postNewProcess(this.type,s,function(s){r.processInstanceId=s,t.Cmdbuild.widgets.savePostponedWidgets(this.widgets,this.widgetsData,{type:r.type,id:r.processInstanceId},i.form,function(){a(s)},this)},this)},this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){this.classAttributes=i,t.Cmdbuild.utilities.proxy.getStartProcessActivities(this.type,this.processInstanceId,function(i){if(i.length>0){var a=i[0]._id;t.Cmdbuild.utilities.proxy.getStartProcessAttributes(this.type,a,function(t){this.loadProcessStepAttributes(t)},this)}},this)},this.loadProcessStepAttributes=function(i){this.instructions=i.instructions,this.activityAttributes=i.attributes,this.attributes=[];for(var a=0;a<this.classAttributes.length;a++)for(var s=0;s<this.activityAttributes.length;s++)if(this.classAttributes[a]._id==this.activityAttributes[s]._id){var e=this.activityAttributes[s],r=this.classAttributes[a];r.mandatory=e.mandatory,r.writable=e.writable,r.index=e.index,this.attributes.push(r)}t.Cmdbuild.utilities.sortAttributes(this.attributes),this.widgets=i.widgets,this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.metadata=i,e()},this.loadData=function(){for(var t=0;t<this.attributes.length;t++)this.data[this.attributes[t]._id]="";""!=this.param.processDescription&&(this.data.Description=this.param.processDescription),this.data[this.param.paramUser]=this.param.user,this.loadDataCallback(this.data,{})},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getInstructions=function(){return this.instructions},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.NewActivity=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.processInstanceId=i.cardId,this.data=[],this.metadata={},this.widgets=void 0;var a=a,s=s;this.updateData=function(t,i){},this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,this.loadData(this.param)},this.loadDataCallback=function(t,i){this.data=t,this.data.activityTitle=this.activityTitle,this.metadata=i,e()},this.loadData=function(){t.Cmdbuild.utilities.proxy.getCardProcess(this.type,this.param.cardId,{},this.loadDataCallback,this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Process=i}(jQuery),function(t){var i=function(i,a,s){this.type=i.className,this.data=[],this.metadata={},this.listData=[],this.typeFilter="attribute",this.filter={},this.filter.attribute={simple:{attribute:"_status",operator:"in",value:[t.Cmdbuild.global.PROCESS_STARTED]}};var a=a,s=s;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getProcessAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(t){this.attributes=t,e()},this.loadData=function(i,a,s){if(this.noValidFilter)return this.data=[],void a.apply(s,this.data);var e={page:i.currentPage,start:i.firstRow,limit:i.nRows,sort:i.sort,direction:i.direction,filter:this.filter,active:!0,filterType:this.typeFilter};t.Cmdbuild.utilities.proxy.getActivityList(this.type,e,function(t,i){this.data=t,this.metadata=i,a.apply(s,this.data)},this)},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.getTotalRows=function(){var t=this.getMetadata();return t&&t.total?t.total:this.getData().length},this.init()};t.Cmdbuild.standard.backend.ReferenceActivityList=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.className,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){this.loadAttributes()},this.loadAttributes=function(){t.Cmdbuild.utilities.proxy.getReportAttributes(this.type,this.loadAttributesCallback,this)},this.loadAttributesCallback=function(i){t.Cmdbuild.utilities.sortAttributes(i),this.attributes=i,e()},this.getAttributes=function(){return this.attributes},this.getData=function(){return this.data},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Report=i}(jQuery),function(t){var i=function(i,a,s){this.param=i,this.type=i.processName,this.data=[],this.metadata={};var a=a,s=s;this.init=function(){t.Cmdbuild.utilities.proxy.getProcessStatuses(function(i){this.data=i,t.Cmdbuild.utilities.proxy.getProcess(this.type,function(t){this.flowStatus=t.defaultStatus,e()},this)},this)},this.getData=function(){return this.data},this.getValue=function(){
return this.flowStatus},this.getMetadata=function(){return this.metadata};var e=function(){a.apply(s)};this.init()};t.Cmdbuild.standard.backend.Select=i}(jQuery);
//# sourceMappingURL=backends.min.js.map