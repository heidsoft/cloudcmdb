function waitingDialog(){$("#loadingScreen").show()}function closeWaitingDialog(){}!function(t){var e={localstorage_key:"CMDBuild-Authorization",types:{BASE:"base",SYSTEM:"system",PORTAL:"portal",URL:"url"},authenticationToken:null,lockedAuth:!1,getAuthenticationUrl:function(){return t.Cmdbuild.global.getApiUrl()+"sessions/"},setAuthenticationToken:function(t){this.authenticationToken=t},getAuthenticationToken:function(){var e=t.Cmdbuild.utilities.readCookie(t.Cmdbuild.access_token);return e?this.authenticationToken=e:!this.authenticationToken&&localStorage&&localStorage.getItem(this.localstorage_key)&&(this.authenticationToken=localStorage.getItem(this.localstorage_key)),this.authenticationToken},lockAuthentication:function(){this.lockedAuth=!0},unlockAuthentication:function(){this.lockedAuth=!1},isAuthLocked:function(){return this.lockedAuth},authenticate:function(){if(!this.isAuthLocked())switch(this.lockAuthentication(),t.Cmdbuild.global.getAuthenticationConfig().type){case this.types.BASE:this.baseAuthentication();break;case this.types.SYSTEM:this.systemAuthentication();break;case this.types.PORTAL:this.portalAuthentication();break;case this.types.URL:this.urlAuthentication();break;default:var e=new t.Cmdbuild.errorsManager.AuthenticationError("Please check authentication config.");t.Cmdbuild.errorsManager.popup(e)}},baseAuthentication:function(){},systemAuthentication:function(){var e={},a=t.Cmdbuild.global.getAuthenticationConfig();if(a.login&&a.login.username&&a.login.password)e.username=a.login.username,e.password=a.login.password,this.doAuthenticate(e);else{var i=t.Cmdbuild.global.getAppConfigUrl()+"auth.xml";t.Cmdbuild.utilities.getXmlDoc(i,this.systemAuthenticationXMLCB,this,{})}},systemAuthenticationXMLCB:function(e,a){if(e){var i=e.documentElement,r=t(i),n={};n.username=r.find(this.types.SYSTEM).find("username").text(),n.password=r.find(this.types.SYSTEM).find("password").text(),this.doAuthenticate(n)}},portalAuthentication:function(){var t={};this.doAuthenticate(t)},urlAuthentication:function(){var e=t.Cmdbuild.global.getAuthenticationConfig();urlconf=e.login.url;var a=this;t.ajax({type:urlconf.method?urlconf.method:"GET",url:urlconf.base,data:urlconf.params,cache:!1,success:function(t){a.onAuthenticationSuccess(t)},error:function(e,a,i){var r=new t.Cmdbuild.errorsManager.AuthenticationError;t.Cmdbuild.errorsManager.popup(r);var n="A problem occurred while authenticating. Please contact the administrator.";t.Cmdbuild.utilities.popupMessage("Authentication error",n)}})},doAuthenticate:function(e){var a=this,i=JSON.stringify(e);t.ajax({type:"POST",url:a.getAuthenticationUrl(),data:i,dataType:"json",contentType:"application/json",success:function(t){if(t){var e=t.data._id;a.onAuthenticationSuccess(e)}},error:function(e,a,i){var r=new t.Cmdbuild.errorsManager.AuthenticationError;t.Cmdbuild.errorsManager.popup(r)}})},onAuthenticationSuccess:function(e){this.setAuthenticationToken(e),this.unlockAuthentication(),t.Cmdbuild.utilities.startApplication()},getTokenFromLocalStorage:function(){return"undefined"!=typeof Storage?localStorage[this.localstorage_key]:void 0},setTokenToLocalStorage:function(t){"undefined"!=typeof Storage&&(localStorage[this.localstorage_key]=t)}};t.Cmdbuild.authentication=e}(jQuery),function(t){var e={AUTHENTICATION_HEADER:"CMDBuild-Authorization",contentType:"application/json",dataType:"json",loaderrequests:0,makeAjaxRequest:function(e,a,i,r,n){var o=t.Cmdbuild.authentication.getAuthenticationToken(),s=t.Cmdbuild.global.getLanguage();if(o){var l={};l[this.AUTHENTICATION_HEADER]=o,s&&(l["CMDBuild-Localized"]=!0,l["CMDBuild-Localization"]=s),n&&n===!0?this.noJSONAjaxRequest(e,a,i,r,l):this.directMakeAjaxRequest(e,a,i,r,l)}else t.Cmdbuild.authentication.authenticate()},directMakeAjaxRequest:function(e,a,i,r,n){var o=this;this.maskRequest(),t.ajax({type:a,url:e,data:r,cache:!1,dataType:this.dataType,crossDomain:!0,contentType:this.contentType,headers:n}).done(function(t){var e=t?t.data:void 0,a=t?t.meta:void 0;"function"==typeof i?i(e,a):i.success&&i.success(e,a)}).fail(function(t,a,n){"function"==typeof i?console.log("Ajax error = "+e+" -- ",r,Error().stack):i.fail&&i.fail()}).always(function(){"function"!=typeof i&&i.callback&&i.callback(),o.unmaskRequest()})},noJSONAjaxRequest:function(e,a,i,r,n){var o=this;this.maskRequest(),t.ajax({type:a,url:e,data:r,cache:!1,contentType:!1,processData:!1,headers:n}).done(function(t){"function"==typeof i?i(t):i.success&&i.success(t)}).fail(function(t,a,n){"function"==typeof i?console.log("Ajax error = "+e+" -- ",r,Error().stack):i.fail&&i.fail()}).always(function(){"function"!=typeof i&&i.callback&&i.callback(),o.unmaskRequest()})},maskRequest:function(){var e=t.Cmdbuild.global.getHtmlContainer().getAttribute("id");0===this.loaderrequests&&t("#"+e).waitMe({effect:"stretch",color:"#1c94c4"}),this.loaderrequests++},unmaskRequest:function(){var e=t.Cmdbuild.global.getHtmlContainer().getAttribute("id");this.loaderrequests--,0===this.loaderrequests&&t("#"+e).delay(500).waitMe("hide")}};t.Cmdbuild.authProxy=e}(jQuery),function(t){var e={context:[],push:function(t){this.context.push({container:t.container,form:t.form})},pop:function(t){for(var e=0;e<this.context.length;e++)t.container==this.context[e].container&&this.context.splice(e,this.context.length-e)},path:function(t){for(var e="",a=0;a<this.context.length&&(e+=this.context[a].container+"_",t.container!=this.context[a].container);a++);return e},getFormPath:function(t){for(var e=this.context.length-1;e>=0;e--)if(t==this.context[e].form)return this.path({container:this.context[e].container})}};t.Cmdbuild.standard.contextStack=e}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(t){return s.raw?t:encodeURIComponent(t)}function a(t){return s.raw?t:decodeURIComponent(t)}function i(t){return e(s.json?JSON.stringify(t):String(t))}function r(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(o," ")),s.json?JSON.parse(t):t}catch(e){}}function n(e,a){var i=s.raw?e:r(e);return t.isFunction(a)?a(i):i}var o=/\+/g,s=t.cookie=function(r,o,l){if(void 0!==o&&!t.isFunction(o)){if(l=t.extend({},s.defaults,l),"number"==typeof l.expires){var d=l.expires,u=l.expires=new Date;u.setTime(+u+864e5*d)}return document.cookie=[e(r),"=",i(o),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var c=r?void 0:{},m=document.cookie?document.cookie.split("; "):[],p=0,g=m.length;g>p;p++){var f=m[p].split("="),b=a(f.shift()),h=f.join("=");if(r&&r===b){c=n(h,o);break}r||void 0===(h=n(h))||(c[b]=h)}return c};s.defaults={},t.removeCookie=function(e,a){return void 0===t.cookie(e)?!1:(t.cookie(e,"",t.extend({},a,{expires:-1})),!t.cookie(e))}}),function(t){var e={insertChildren:function(t){for(var e="",a=0;a<t.childNodes.length;a++)e+=this.toHtml(t.childNodes[a]);return e},toHtml:function(e){try{var a=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.MALFORMEDXMLNODE,element:e.nodeName});if("html"==e.nodeName)throw a;if("ldap"==e.nodeName)return"";if("rowButton"==e.nodeName)return"";if("columnsCommands"==e.nodeName)return"";if("#text"==e.nodeName)return"";if("onInit"==e.nodeName)return"";if("onDblClick"==e.nodeName)return"";if("onClick"==e.nodeName)return"";if("onChange"==e.nodeName)return"";if("params"==e.nodeName)return"";if("form"==e.nodeName)return"";if("openEntry"==e.nodeName)return"";if("#comment"==e.nodeName)return"";if("observe"==e.nodeName)return"";if("fields"==e.nodeName)return"";if("widgets"==e.nodeName)return"";if("buttons"==e.nodeName)return"";if(t.Cmdbuild.custom.elements&&t.Cmdbuild.custom.elements[e.nodeName]){var i=t.Cmdbuild.custom.elements[e.nodeName](e);return i}if(t.Cmdbuild.standard.elements[e.nodeName]){var i=t.Cmdbuild.standard.elements[e.nodeName](e);return i}console.log(e.nodeName+" not found!");var a=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.XMLTAGNOTDEFINED,element:e.nodeName});throw a}catch(r){var n="$.Cmdbuild.elementsManager.toHtml";throw t.Cmdbuild.errorsManager.log(n),t.Cmdbuild.errorsManager.log(r),r}return""},insertLoadingMask:function(t){var e="<div id='"+t+"'><h1>wait wait wait</h1></div>";return e},insertDialog:function(e,a){var i="<div id='"+e+"'></div>";return t.Cmdbuild.scriptsManager.push({script:"dialog",id:e,callback:a}),i},getText:function(e){var a=e.getAttribute("i18nText"),i=e.getAttribute("variableText"),r="";return r=t.Cmdbuild.utilities.escapeHtml(e.getAttribute("text")),i&&(r+=" "+t.Cmdbuild.dataModel.resolveVariable(i)),a?t.Cmdbuild.translations.getTranslation(a,r):r},getTooltip:function(e){var a=e.getAttribute("i18nTooltip"),i="";return i=t.Cmdbuild.utilities.escapeHtml(e.getAttribute("tooltip")),a?t.Cmdbuild.utilities.escapeHtml(t.Cmdbuild.translations.getTranslation(a,i)):i},getXmlElementId:function(t){var e=t.getAttribute("id");return e},getCommonAttributes:function(e){var a=" ",i=t.Cmdbuild.elementsManager.getXmlElementId(e);i&&(a+="id='"+i+"' ");var r=e.getAttribute("class");r&&(a+="class='"+r+"' ");var n=e.getAttribute("interactivity");n&&(a+="interactivity='"+n+"' ",a+=n==t.Cmdbuild.global.READ_ONLY?" disabled ":"");var o=e.getAttribute("title");o&&(a+="title='"+o+"' ");var s=e.getAttribute("formName");s&&(a+="formName='"+s+"' ");var l=e.getAttribute("fieldName");l&&(a+="fieldName='"+l+"' ");var d=e.getAttribute("height");d&&(a+="height='"+d+"' ");var u=e.getAttribute("width");u&&(a+="width='"+u+"' ");var c=t.Cmdbuild.elementsManager.getTooltip(e);return c&&(a+="title='"+c+"' "),a},insertReturn:function(t){var e="",a=t.getAttribute("withReturn");return"true"==a&&(e+="<br/>"),e},isReturn:function(t){return"true"==t.getAttribute("withReturn")?!0:!1},insertLabel:function(e){var a=t.Cmdbuild.elementsManager.getXmlElementId(e),i=e.getAttribute("label"),r=e.getAttribute("i18nLabel");r&&(i=t.Cmdbuild.translations.getTranslation(r,i));var n=e.getAttribute("interactivity")||t.Cmdbuild.global.READ_WRITE,o=n==t.Cmdbuild.global.READ_WRITE_REQUIRED?"* ":"",s=e.getAttribute("classLabel"),l=" class='cmdbuildLabel"+(s?" "+s:"")+"'";return htmlStr="<label for='"+a+"'"+l+">"+o+i+"</label>",i?htmlStr:""},wrapInLayoutContainer:function(t,e){var a=t.getAttribute("labelPosition");return"over"==a?"<div class='cdmdbuildVboxContainer'>"+e+"</div>":e},wrapInRowContainer:function(e,a){var i=t.Cmdbuild.elementsManager.isReturn(e)?" cmdbuildBlockFormRow":"";return"<div class='cmdbuildFormRow"+i+"'>"+a+"</div>"},wrapInFormRow:function(e,a,i,r){var n=t("<dl></dl>").addClass("cmdbuildGuiFormRow").addClass("cmdbuildGuiFormRow-"+i);r&&n.addClass("cmdbuildGuiFormRowReadOnly");var o=t("<dt></dt>").html(e);e&&n.append(o);var s=t("<dd></dd>").html(a);return n.append(s),n.prop("outerHTML")},getEvent:function(e,a){var i={},r=t(a),n=r.children(e);return n.children().length?(i.id=r.attr("id"),n.children().each(function(e){var a=t(this).prop("tagName"),r=t(this).text();i[a]=r}),i):null},getGroupElements:function(e,a,i){i=i||{};var r=t(e),n=r,o=n.children(a);return o.children().each(function(e){var a=t(this).prop("tagName");if(!i[a]){var r=t(this).text();i[a]=r}}),t.isEmptyObject(i)?null:i},getRowButtons:function(e,a){var i=[],r=t(e);r.children("rowButton").each(function(e){i.push({id:t(this).attr("id"),tooltip:t(this).attr("tooltip"),className:t(this).attr("class"),onClick:t.Cmdbuild.elementsManager.getEvent("onClick",this),onMouseOver:t.Cmdbuild.elementsManager.getEvent("onMouseOver",this),params:t.Cmdbuild.elementsManager.getParams(this)}),t.Cmdbuild.dataModel.prepareCallerParameters(t(this).attr("id"),t.Cmdbuild.elementsManager.getParams(this))}),a.rowButtons=i},getColumnsCommands:function(e,a){var i=[],r=t(e);r.children("columnsCommands").children("column").each(function(e,a){i.push({attribute:t(a).children("name").text(),icon:t(a).children("icon").text(),onClick:t.Cmdbuild.elementsManager.getEvent("onClick",this)})}),a.columnsCommands=i},getParams:function(t,e){return this.getGroupElements(t,"params",e)},isObserving:function(e,a){var i=this.getGroupElements(e,"observe");if(i){var r=e.getElementsByTagName("observe")[0].getAttribute("container");return t.Cmdbuild.dataModel.setObserver({container:r,form:a,fields:i}),!0}return!1},getElement:function(e){var a=t(t.Cmdbuild.global.getConfigurationDocument()),i=a.find("#"+e);if(!i){var r=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.XMLELEMENTNOTDEFINED,element:e});throw r}return i[0]},initialize:function(){t.Cmdbuild.scriptsManager.execute()},makeServiceButton:function(e,a,i,r){var n="";return n+="<button class='"+e+"' id='"+a+"' onclick='"+r+"'></button>",t.Cmdbuild.scriptsManager.push({script:"button",id:a,icon:i}),n},loadIconButtons:function(e,a,i){for(var r=0;r<a.length;r++){var n=t.Cmdbuild.dataModel.resolveVariables(a[r].params);if("false"!=n.condition){var o={type:"IMAGEBUTTON",displayableInList:!0,active:!0,name:a[r].id,className:a[r].className?a[r].className:a[r].id,tooltip:a[r].tooltip,onClick:JSON.stringify(a[r].onClick)};"left"==i?e.splice(r,0,o):e.push(o)}}},pushSelectionCheck:function(e,a){var i={type:"ROWSELECTIONCHECK",displayableInList:!0,active:!0,name:"selectionCheck",tooltip:t.Cmdbuild.global.SELECTIONTOOLTIP};"left"==a?e.splice(0,0,i):e.push(i)}};t.Cmdbuild.elementsManager=e}(jQuery),function(t){var e="An error is occured!";AuthenticationError=function(t){this.name="AuthenticationError",this.message=t||"Authentication error"},AuthenticationError.prototype=new Error,AuthenticationError.prototype.constructor=AuthenticationError;var a={isDialogOpen:!1,CMERROR:"cmError",ERROREXPLAINED:1,EVENTCOMMANDNOTFOUND:101,EVENTMETHODNOTDEFINED:102,INITNOTDEFINED:103,XMLTAGNOTDEFINED:201,MALFORMEDXMLNODE:202,BACKENDMETHODNOTDEFINED:301,FORMFIELDMETHODNOTDEFINED:401,AJAXERROR:501,AJAXERRORNOTFOUND:502,XMLELEMENTNOTDEFINED:601,MALFORMEDVARIABLE:602,SCRIPTNOTDEFINED:701,XMLFILENOTFOUND:801,XMLFILENOTCORRECT:802,PARAMNOTCORRECT:901,AUTHENTICATIONERROR:902,CONTAINERNOTFOUND:1001,CONFIGURATIONDOCUMENTNOTFOUND:1002,CLASSNOTFOUND:1101,CLASSNOTFOUND:1101,UNDEFINEDDEFAULTROLE:1201,AuthenticationError:AuthenticationError,strings:{0:"Errore {1} non riconosciuto",1:"{1}",101:"Non è definito l'elemento Command.\nElement Xml: {1}",102:"Comando non riconosciuto.\nElement Xml: {1}\nComando:{2}",103:"Init [ {1} {2} ] nella form [ {3} ] non definito",201:"Elemento {1} non definito",202:"Nodo Xml {1} non corretto",301:"Backend {1} non definito",501:"Ajax: errata richiesta.\nUrl: {1}",502:"Ajax: elemento non trovato nel Datatabase.\nUrl: {1}",601:"Elemento Xml [ {1} ] non presente nel file di configurazione",602:"Formato della variabile [ {1} ]\nerrato in [ {2} ]",701:"Script [ {1} ] non definito in {2}",801:"Xml file [ {1} ] non trovato",802:"Xml file [ {1} ] non corretto",901:"Parametro [ {1} {2} ] nella form [ {3} ] non corretto",902:"Credenziali di login non trovate: table {1} key {2} value {3}",1001:"Container Html non definito",1002:"Configuration [ {1} ] non definito",1101:"Classe [ {1} ] non trovata",1201:"Default role non definito per questo utente"},log:function(t){"object"==typeof t&&t.cmParam?console.log(t,t.cmParam.type,t.stack):"object"==typeof t?console.log(t,t.stack):console.log(t,t.stack)},warn:function(t){console.warn(t)},error:function(t){console.error(t)},popupOnRequestFields:function(e){if(e.length>0){for(var a="",i=0;i<e.length;i++){var r=e[i];a+="<p>",a+=r.message?"<strong>"+r.field+":</strong> "+r.message:"Il campo "+r.field+" deve essere valorizzato",a+="</p>"}var n=t("#errorDialog");return n.html(a),n.dialog("option","dialogClass",t.Cmdbuild.global.getThemeCSSClass()),n.dialog("option","title","Error!").dialog("open"),n.dialog("option","height",400),n.dialog("option","width",600),n.dialog("open"),!1}},popup:function(a){if(!this.isDialogOpen){this.isDialogOpen=!0,this.log(a);var i="";i+="<h2>"+e+"</h2>",a.message==this.CMERROR?(i+="<p>"+a.cmParam.type+"</p>",i+="<p>"+this.getErrorMessage(a)+"</p>"):i+="<p>"+a.message+"</p>";var r=t("#errorDialog");r.html(i),r.dialog("option","dialogClass",t.Cmdbuild.global.getThemeCSSClass()),r.dialog("option","title",a.name).dialog("open"),r.dialog("option","height",400),r.dialog("option","width",600),r.dialog("open")}},close:function(){this.isDialogOpen=!1},getErrorMessage:function(e){switch(e.cmParam.type){case this.ERROREXPLAINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.EVENTCOMMANDNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.EVENTMETHODNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element,e.cmParam.method);case this.INITNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.param,e.cmParam.method,e.cmParam.element);case this.XMLTAGNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.MALFORMEDXMLNODE:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.BACKENDMETHODNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.AJAXERROR:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.AJAXERRORNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.XMLELEMENTNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.MALFORMEDVARIABLE:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.variable,e.cmParam.element);case this.SCRIPTNOTDEFINED:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.XMLFILENOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.XMLFILENOTCORRECT:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.PARAMNOTCORRECT:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.param,e.cmParam.method,e.cmParam.element);case this.AUTHENTICATIONERROR:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.table,e.cmParam.key,e.cmParam.value);case this.CONTAINERNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type]);case this.CONFIGURATIONDOCUMENTNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.CLASSNOTFOUND:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type],e.cmParam.element);case this.UNDEFINEDDEFAULTROLE:return t.Cmdbuild.utilities.formatVarString(this.strings[e.cmParam.type]);default:return t.Cmdbuild.utilities.formatVarString(this.strings[0],e.cmParam.type,e.cmParam.element)}},getError:function(t){var e=new Error(t.message);return e.cmParam=t,e}};t.Cmdbuild.errorsManager=a}(jQuery),function(t){var e={events:[],deferred:0,onEvent:function(t){t&&(this.events.push(t),this.executeAllEvents())},deferEvents:function(){this.deferred++},unDeferEvents:function(){this.deferred--,this.executeAllEvents()},executeAllEvents:function(){if(!(this.deferred>0))for(;this.events.length>0;){var t=this.events[0];this.events.splice(0,1),this.executeEvent(t)}},executeEvent:function(e){try{if(!e.command){var a=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.EVENTCOMMANDNOTFOUND,element:e.id});throw a}if(t.Cmdbuild.dataModel.callerParameters[e.id]&&t.Cmdbuild.dataModel.pushParametersOnStack(e.id),t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands[e.command])t.Cmdbuild.custom.commands[e.command](e);else{if(!t.Cmdbuild.standard.commands[e.command]){var a=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.EVENTMETHODNOTDEFINED,element:e.id,method:e.command});throw a}t.Cmdbuild.standard.commands[e.command](e)}}catch(i){throw t.Cmdbuild.errorsManager.log("$.Cmdbuild.eventsManager.executeEvent "+e.command),i}}};t.Cmdbuild.eventsManager=e}(jQuery),function(t){var e="cmdbuildGuiFormField",a={types:{BOOLEAN:"boolean",CHAR:"char",DATE:"date",DECIMAL:"decimal",DOUBLE:"double",IPADDRESS:"ipAddress",INTEGER:"integer",LOOKUP:"lookup",REFERENCE:"reference",STRING:"string",TEXT:"text",TIME:"time",DATETIME:"dateTime"},generateHTML:function(t,e,a,i){var r=t.writable===!0||"true"===t.writable,n=t.mandatory===!0||"true"===t.mandatory,o=this.getFormFieldContainer(e,t._id,t.type,t.description,t.hidden,!r,n),s=this.getFormField(t,e,a,i);return t.hidden?o.append(s):o.find("dd").append(s),o},getFieldValidator:function(e){var a={};switch(e.mandatory&&(a.required=!0),e.type){case this.types.DECIMAL:a.decimal=[e.precision,e.scale];break;case this.types.DOUBLE:a.number=!0;break;case this.types.IPADDRESS:"ipv4"===e.ipType?a.ipv4=!0:"ipv6"===e.ipType&&(a.ipv6=!0);break;case this.types.INTEGER:a.integer=!0;break;default:$output=t("<span></span>").text(e.type+" not implemented")}return{rules:a}},getFormFieldContainer:function(a,r,n,o,s,l,d){var u,c=i(a,r);if(s)u=t("<div></div>");else{u=t("<dl></dl>").addClass(e).addClass(e+"-"+n),l?u.addClass(e+"ReadOnly"):d&&(o="* "+o);var m=t("<dt></dt>").append(t("<label></label>").addClass("cmdbuildLabel").attr("for",c).text(o));u.append(m).append(t("<dd></dd>"))}return u.attr("id",c+"_container"),u},getFormField:function(e,a,i,r){var h,C=this;if(e.hidden)h=n(a,e._id,r);else switch(e.type){case C.types.BOOLEAN:h=o(a,e,r);break;case C.types.CHAR:h=s(a,e,r);break;case C.types.DATE:h=l(a,e,r);break;case C.types.DATETIME:h=l(a,e,r);break;case C.types.DECIMAL:h=d(a,e,r);break;case C.types.DOUBLE:h=u(a,e,r);break;case C.types.IPADDRESS:e.ipType="ipv4",h=c(a,e,r);break;case C.types.INTEGER:h=m(a,e,r);break;case C.types.LOOKUP:h=p(a,e,r);break;case C.types.REFERENCE:h=g(a,i,e,r);break;case C.types.STRING:h=f(a,e,r);break;case C.types.TEXT:h=b(a,e,r);break;case C.types.TIME:h=l(a,e,r);break;default:h=t("<span></span>").text(e.type+" not implemented")}return h},getFieldId:function(t,e){return i(t,e)}},i=function(t,e){return t+"-field-"+e},r=function(t,e,a){if(t.attr("id",i(a,e._id)),t.attr("formName",a).attr("form",a),t.attr("name",e._id).attr("fieldName",e._id),e.className&&t.addClass(e.className),e.title||e.tooltip){var r=e.title?e.title:e.tooltip;t.attr("title",r)}e.width&&t.attr("width",e.width),e.height&&t.attr("height",e.height)},n=function(e,a,i){var n=t("<input></input>").attr("type","hidden");return r(n,{_id:a},e),i&&n.val(i),n},o=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","checkbox");return r(o,a,e),(i===!0||"true"===i)&&o.attr("checked","checked"),o}var o=n(e,a._id,i),s=i===!0||"true"===i?"Yes":"No";return[s,o]},s=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");return r(o,a,e),o.attr("maxlength",1).attr("size",1),i&&o.val(i),o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},l=function(e,a,i){if(i&&(i=t.Cmdbuild.utilities.convertDateDB2GUI(i,a.type)),a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");switch(r(o,a,e),o.attr("isDate",!0).attr("date-input-type",a.type),i&&(i=t.Cmdbuild.utilities.convertDateDB2GUI(text,param.type),o.val(i)),a.type){case"time":o.timepicker({timeFormat:"HH:mm:ss"});break;case"date":o.datepicker({dateFormat:"dd/mm/yy"});break;case"dateTime":o.datetimepicker({dateFormat:"dd/mm/yy",timeFormat:"HH:mm:ss"})}return o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},d=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");return r(o,a,e),i&&o.val(i),o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},u=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");return r(o,a,e),i&&o.val(i),o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},c=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");return r(o,a,e),"ipv4"===a.ipType?o.attr("maxlength","15"):"ipv6"===a.ipType&&o.attr("maxlength","39"),i&&o.val(i),o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},m=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");return r(o,a,e),i&&o.val(i),o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},p=function(e,a,i){var o,s=a.writable===!0||"true"===a.writable;if(s){var o=t("<select></select>");r(o,a,e),t("#"+e).on("DOMNodeInserted",function(e){t(e.target).find("#"+o.attr("id")).length&&o.selectmenu({change:function(e,a){var i={id:o.attr("id")};t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.fieldChanged?t.Cmdbuild.custom.commands.fieldChanged(i):t.Cmdbuild.standard.commands.fieldChanged(i)}})})}else var o=n(e,a._id,i);var l=o.attr("id");return new t.Cmdbuild.standard.lookupField({form:e,id:l,readOnly:!s,lookupType:a.lookupType,value:i}),o},g=function(e,a,i,o){var s,l=[],d=i.writable===!0||"true"===i.writable;if(d){var s=t("<select></select>");r(s,i,e);var u=t("<button></button>").attr("id",s.attr("id")+"_btnsearch").addClass("cmdbuildButton").button({icons:{primary:"ui-icon-search"},text:!1}).click(function(t){return s.trigger("searchreferenceitem"),!1}),c=t("<button></button>").attr("id",s.attr("id")+"_btnclear").addClass("cmdbuildButton").button({icons:{primary:"ui-icon-closethick"},text:!1}).click(function(t){return s.trigger("clearreference"),!1});t("#"+e).on("DOMNodeInserted",function(e){t(e.target).find("#"+s.attr("id")).length&&s.selectmenu({change:function(e,a){var i={id:s.attr("id")};t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.fieldChanged?t.Cmdbuild.custom.commands.fieldChanged(i):t.Cmdbuild.standard.commands.fieldChanged(i)}})}),l.push(s,u,c)}else{var s=n(e,i._id,o);l.push(s)}var m=s.attr("id");return new t.Cmdbuild.standard.referenceField({id:m,container:a,targetClass:i.targetClass,targetType:i.targetType,filter:i.filter,readOnly:!d,optionsLimit:null,value:o,displayAttribute:null}),l},f=function(e,a,i){if(a.writable===!0||"true"===a.writable){var o=t("<input></input>").attr("type","text");return r(o,a,e),a.length&&o.attr("maxlength",a.length),i&&o.val(i),o}var o=n(e,a._id,i),s=t("<span></span>").text(i?i:"");return[s,o]},b=function(e,a,i){var n=t("<textarea></textarea>");r(n,a,e),i&&n.val(i);var o="HTML"===a.editorType?!0:!1;if(a.writable===!0||"true"===a.writable){var s=6;return a.rows&&(s=a.rows),n.attr("rows",s),a.cols&&n.attr("cols",a.cols),a.length&&n.attr("maxlength",a.lenght),o&&t("#"+e).on("DOMNodeInserted",function(e){t(e.target).find("#"+n.attr("id")).length&&n.cleditor({controls:"bold italic underline | size | color highlight | alignleft center alignright justify | link unlink | bullets numbering | pastetext | removeformat | source"})}),n}var l=t("<div></div>").addClass("textareaReadOnly");return o?l.html(i):l.text(i),n.addClass("hiddentextarea").attr("disabled","disabled"),[l,n]};t.Cmdbuild.fieldsManager=a}(jQuery),function(t){var e={CQLUNDEFINEDVALUE:"CMDBUILDUNDEFINEDFIELD",MAILSTATUSDRAFT:"draft",MAILSTATUSNEW:"new",MAILSTATUSOUTGOING:"outgoing",MAILSTATUSRECEIVED:"received",NOVALUEONREQUIREDFIELD:"NOVALUEONREQUIREDFIELD",LOOKUPPROCESSSTATUSES:"FlowStatus",STATE_VALUE_OPEN:"",STATE_VALUE_SUSPENDED:"open.not_running.suspended",STATE_VALUE_COMPLETED:"closed.completed",STATE_VALUE_ABORTED:"closed.aborted",STATE_VALUE_ALL:"all",PROCESS_STARTED:1,PROCESS_SUSPENDED:2,PROCESS_COMPLETED:3,PROCESS_STOPPED:4,PROCESS_INTERRUPTED:5,READ_WRITE_REQUIRED:"READ_WRITE_REQUIRED",READ_WRITE:"READ_WRITE",READ_ONLY:"READ_ONLY",htmlContainer:null,themeCSSClass:null,debugMode:void 0,ID_TAGS:["onClick > dialog","onClick > form","onClick > container","onClick > *[variableId='true']","onInit > dialog","onInit > form","onInit > container","onInit > *[variableId='true']","onChange > dialog","onChange > form","onChange > container","onInit > *[variableId='true']","params > *[variableId='true']","observe > *[variableId='true']"],ID_TAGSWITHVARIABLEATTRIBUTES:[["observe","container"]],WIDTH_REFERENCE:400,GRIDROWSCOUNT:"Page {1} of {2} (records {3})",GROUPOTHER:"Others",SELECTIONTOOLTIP:"Select element",maxLookupEntries:50,modalMaxHeight:600,modalMaxWidth:800,fieldInteractivityFromProcess:function(t,e){return t&&e?this.READ_WRITE_REQUIRED:t?this.READ_WRITE:this.READ_ONLY},fieldInteractivityFromCard:function(t){return t===!0?this.READ_WRITE_REQUIRED:this.READ_WRITE},getMaxLookupEntries:function(){return this.maxLookupEntries},setHtmlContainer:function(t){this.htmlContainer=t[0]},getHtmlContainer:function(){try{if(this.htmlContainer)return this.htmlContainer;var e=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.CONTAINERNOTFOUND});throw e}catch(a){throw t.Cmdbuild.errorsManager.log(a),a}},setConfigurationDocument:function(e,a){var i={callback:a};t.Cmdbuild.utilities.getXmlDoc(e,this.setConfigurationDocumentCB,this,i)},setConfigurationDocumentCB:function(t,e){this.configurationDocument=t,e.callback()},getConfigurationDocument:function(){try{if(this.configurationDocument)return this.configurationDocument;var e=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.CONFIGURATIONDOCUMENTNOTFOUND,element:""});throw e}catch(a){throw t.Cmdbuild.errorsManager.log(a),a}},setThemeCSSClass:function(t){this.themeCSSClass=t},getThemeCSSClass:function(){return this.themeCSSClass},setApiUrl:function(t){this.apiUrl=t},getApiUrl:function(){return this.apiUrl},setAppRootUrl:function(t){this.appRootUrl=t},getAppRootUrl:function(){return this.appRootUrl},setAppConfigUrl:function(t){this.appConfigUrl=t},getAppConfigUrl:function(){return this.appConfigUrl},setCqlUrl:function(t){this.cqlUrl=t},getCqlUrl:function(){return this.cqlUrl},setLanguage:function(t){this.language=t},getLanguage:function(){return this.language},setDebugMode:function(t){this.debugMode=t},isDebugMode:function(){return this.debugMode},setAuthenticationConfig:function(e){var a={};"string"==typeof e?a.type=e:"object"==typeof e&&e&&e.type?a=e:a.type=t.Cmdbuild.authentication.types.BASE,this.authConf=a},getAuthenticationConfig:function(){return this.authConf},configurationValue:function(e){var a=t.Cmdbuild.custom.configuration;if(a&&a[e])return a[e];var a=t.Cmdbuild.standard.configuration;return a&&a[e]?a[e]:void console.log("Not found config variable "+e)}};t.Cmdbuild.global=e}(jQuery),function(t){var e={configurator:void 0,variables:void 0,form:void 0,write:function(e){try{var a=function(t){console.log("cql.manager: "+t.msg)};this.form=e.form,this.configurator=new Configurator(a);var i=t.Cmdbuild.elementsManager.getElement(e.ldapDescriptor),r=this.getXmlValues(i,"fields","field");this.variables=this.getXmlValues(i,"variables","variable"),ldapRecord={},this.evaluateFields(r,ldapRecord,function(){ldapRecord=JSON.stringify(ldapRecord),t.Cmdbuild.utilities.proxyGuiServerSide.postLdap(ldapRecord,function(t){},this)},this)}catch(n){console.log("$.Cmdbuild.ldap.write "+n.message),t.Cmdbuild.errorsManager.popup(n)}},evaluateFields:function(e,a,i,r){try{if(e.length<=0)return void i.apply(r,[a]);var n=e[0];e.splice(0,1);var o=n.values.split(","),s=[n.format];this.evaluateSingleFields(o,s,function(){a[n.ldapName]=sprintf.apply(null,s),this.evaluateFields(e,a,i,r)},this)}catch(l){console.log("$.Cmdbuild.ldap.evaluateFields "+l.message),t.Cmdbuild.errorsManager.popup(l)}},evaluateSingleFields:function(e,a,i,r){try{if(e.length<=0)return void i.apply(r);var n=t.trim(e[0]);if(e.splice(0,1),
"cql:"==(""+n).substr(0,4))this.resolveCql(n,function(t){a.push(t),this.evaluateSingleFields(e,a,i,r)},this);else{var o=t.Cmdbuild.dataModel.getValue(this.form,t.trim(n));a.push(o),this.evaluateSingleFields(e,a,i,r)}}catch(s){console.log("$.Cmdbuild.ldap.evaluateSingleFields "+s.message),t.Cmdbuild.errorsManager.popup(s)}},resolveCql:function(e,a,i){try{var r=(""+e).substr(4),n=r.split(".");if(2!=n.length)throw new t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"ldap resolveCql",element:e});this.getVariable(n[0],function(t){this.resolveCqlCallback(t,n,a,i)},this)}catch(o){console.log("$.Cmdbuild.ldap.resolveCql "+o.message),t.Cmdbuild.errorsManager.popup(o)}},resolveCqlCallback:function(e,a,i,r){try{this.configurator.manager.cql.getValue("",e,function(n){if(n&&n.length<=0)throw new t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"ldap resolveCql: Cql failed",element:e});var o="";n&&1==n.length&&(o=n[0][a[1]],"object"==typeof o&&(o=o.description)),i.apply(r,[o])},this)}catch(n){console.log("$.Cmdbuild.ldap.resolveCql "+n.message),t.Cmdbuild.errorsManager.popup(n)}},getVariable:function(e,a,i){for(var r=0;r<this.variables.length;r++)if(this.variables[r].key==e){var n={filter:this.variables[r].cql,meta:{},form:this.form};return void cqlEvaluate(n,function(t){a.apply(i,[t])},this)}throw new t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"ldap resolveCql",element:"variable "+e+" not defined"})},getXmlValues:function(e,a,i){var r=t(e),n=r.find(a);if(n.length){for(var o=[],s=t(n[0]),l=0;l<s.children(i).length;l++){for(var d=t(s.children(i)[l]),u=d.children("*"),c={},m=0;m<u.length;m++){var p=t(u[m]),g=p.text(),f=p[0].tagName;c[f]=g}o.push(c)}return o}}};t.Cmdbuild.ldap=e}(jQuery),function($){var dataModel={model:[],observers:{},forms:{},formFields:{},callerParameters:{},parameters:{},widgets:{},attachments:{},classes:[],processes:[],observing:!0,isAProcess:function(t){return $.grep(this.processes,function(e){return e._id==t}).length>0},isAClass:function(t){return $.grep(this.classes,function(e){return e._id==t}).length>0},setClasses:function(t){this.classes=t},setProcesses:function(t){this.processes=t},cleanForm:function(t){this.forms[t]&&delete this.forms[t]},substituteWidgetWindow:function(t,e){this.widgets[t]=e},putWidgetWindow:function(t,e){this.widgets[t]=e},getWidgetWindow:function(t){return this.widgets[t]},prepareCallerParameters:function(t,e){$.Cmdbuild.dataModel.callerParameters[t]=e},pushSingleParameterOnStack:function(t,e){$.Cmdbuild.dataModel.parameters[t]=e},pushParametersOnStack:function(t){var e=$.Cmdbuild.dataModel.callerParameters[t];for(var a in e){var i=e[a];$.Cmdbuild.dataModel.parameters[a]=i}},getParameter:function(t){return $.Cmdbuild.dataModel.parameters[t]},deleteParameter:function(t){delete $.Cmdbuild.dataModel.parameters[t]},addFields:function(t,e){var a=[];for(var i in t)for(var r=0;r<e.length;r++){var n=e[r];if(i==n._id){n.displayableInList=!0;for(k in t[i])n[k]=t[i][k];a.push(n);break}}return a},evaluateFields:function(t,e){for(var a=[],i=this,r=0;r<e.length;r++){var n=e[r];for(var o in t)if(o==n._id){var s=t[o];if(jQuery.isEmptyObject(s)){n=null;break}if(s)for(var l in s)"interactivity"===l?($.Cmdbuild.errorsManager.warn("Interactivity is deprecated. Use hidden or writable properties"),s[l]===$.Cmdbuild.global.READ_ONLY?(n.writable=!1,n.mandatory=!1):s[l]===$.Cmdbuild.global.READ_WRITE_REQUIRED?(n.writable=!0,n.mandatory=!0):s[l]===$.Cmdbuild.global.READ_WRITE&&(n.writable=!0,n.mandatory=!1)):n[l]=i.resolveVariable(s[l]);break}n&&a.push(n)}return a},evaluateXmlAttributes:function(t,e){if($.Cmdbuild.dataModel.formFields[t]){var a=$.Cmdbuild.dataModel.getFormFields(t),i=a.fields,r="evaluate"==a.method?this.evaluateFields(i,e):this.addFields(i,e);e.splice(0,e.length);for(var n=0;n<r.length;n++)e.push(r[n])}},evaluateJSONAttributes:function(t,e){if(e){var a="evaluate"==e.method?this.evaluateFields(e.fields,t):this.addFields(e.fields,t);t.splice(0,t.length);for(var i=0;i<a.length;i++)t.push(a[i])}},getFormFields:function(t){return $.Cmdbuild.dataModel.formFields[t]?$.Cmdbuild.dataModel.formFields[t]:void 0},putFormFields:function(t){t.fields?$.Cmdbuild.dataModel.formFields[t.form]=t:delete $.Cmdbuild.dataModel.formFields[t.form]},getCurrentIndex:function(t){return $.Cmdbuild.dataModel.model[t].currentIndex},setCurrentIndex:function(t,e){$.Cmdbuild.dataModel.model[t].currentIndex=e,$.Cmdbuild.dataModel.dispatchChange(t)},setValues:function(t,e){if(!$.Cmdbuild.dataModel.model[t])return{};var a=$.Cmdbuild.dataModel.model[t].currentIndex;return-1==a?{}:void(void 0!==a?$.extend($.Cmdbuild.dataModel.model[t].data[a],e):$.extend($.Cmdbuild.dataModel.model[t].data,e))},getData:function(t){return $.Cmdbuild.dataModel.model[t]&&$.Cmdbuild.dataModel.model[t].data?$.Cmdbuild.dataModel.model[t].data:[]},getValues:function(t){if($.Cmdbuild.standard.contextStack.getFormPath({form:t}),!$.Cmdbuild.dataModel.model[t])return"";var e=$.Cmdbuild.dataModel.model[t].currentIndex;return-1==e?"":void 0!==e?$.Cmdbuild.dataModel.model[t].data[e]:$.Cmdbuild.dataModel.model[t].data},getValue:function(t,e){if(!$.Cmdbuild.dataModel.model[t])return"";var a=$.Cmdbuild.dataModel.model[t].currentIndex;return-1==a?"":void 0!==a?$.Cmdbuild.dataModel.model[t].data[a][e]:$.Cmdbuild.dataModel.model[t].data[e]},push:function(t){try{$.Cmdbuild.dataModel.model[t.form]={type:t.type,currentIndex:t.currentIndex,data:t.data,backup:$.Cmdbuild.utilities.clone(t.data)}}catch(e){e.message+="\n$.Cmdbuild.dataModel.push",$.Cmdbuild.errorsManager.log(e)}},flush:function(t,e,a){try{t.data=$.Cmdbuild.dataModel.model[t.form].data,t.formObject.flush(t,function(i){if($.Cmdbuild.dataModel.model[t.form].backup=$.Cmdbuild.utilities.clone($.Cmdbuild.dataModel.model[t.form].data),$.Cmdbuild.dataModel.dispatchChange(t.form),t.successMessage||t.i18nSuccessMessage){var r=t.successMessage;t.i18nSuccessMessage&&(r=$.Cmdbuild.translations.getTranslation(t.i18nSuccessMessage,t.successMessage?t.successMessage:t.i18nSuccessMessage)),$("<div />").html(r).dialog({dialogClass:"no-close",buttons:[{text:"OK",click:function(){$(this).dialog("destroy")}}]})}e.apply(a,[i])},this)}catch(i){throw $.Cmdbuild.dataModel.model[t.form].data=$.Cmdbuild.utilities.clone($.Cmdbuild.dataModel.model[t.form].backup),$.Cmdbuild.dataModel.reset(t),$.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.flush"),i}},reset:function(t){try{t.data=$.Cmdbuild.dataModel.model[t.form].data,t.formObject.reset(t)}catch(e){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.reset"),e}},change:function(t){try{t.data=$.Cmdbuild.dataModel.model[t.form].data;var e=t.formObject.change(t);if(e.length>0)return $.Cmdbuild.errorsManager.popupOnRequestFields(e),!1}catch(a){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.change"),a}return!0},resolveParametersVariable:function(t){var e=$.Cmdbuild.dataModel.parameters[t],a=$.Cmdbuild.dataModel.resolveVariable(e);return a},resolveInterfaceVariable:function(t){var e=$.Cmdbuild.utilities.getHtmlFieldValue("#"+t);return e},resolveWindowVariable:function(field){return eval("window."+field)},resolveCMDBuildVariable:function(t){return $.Cmdbuild.customvariables[t]},resolveModelVariable:function(t,e){var a=$.Cmdbuild.dataModel.getValue(t,e);return a},resolveAnd:function(t){t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1);for(var e=t.split(","),a=0;a<e.length;a++)if(!$.Cmdbuild.dataModel.resolveVariable($.trim(e[a])))return!1;return!0},resolveAnd:function(t){t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1);for(var e=t.split(","),a=0;a<e.length;a++)if(!$.Cmdbuild.dataModel.resolveVariable($.trim(e[a])))return!1;return!0},resolveOr:function(t){t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1);for(var e=t.split(","),a=0;a<e.length;a++)if($.Cmdbuild.dataModel.resolveVariable($.trim(e[a])))return!0;return!1},resolveNot:function(t){return t=$.trim(t),t=t.substr(1),t=t.substr(0,t.length-1),!$.Cmdbuild.dataModel.resolveVariable($.trim(t))},resolveVariable:function(t){var e="";if("$and"==(""+t).substr(0,4))e=$.Cmdbuild.dataModel.resolveAnd(t.substr(4));else if("$or"==(""+t).substr(0,3))e=$.Cmdbuild.dataModel.resolveOr(t.substr(3));else if("$not"==(""+t).substr(0,4))e=$.Cmdbuild.dataModel.resolveNot(t.substr(4));else if("$"==(""+t).substr(0,1)){var a=t.substr(1),i=a.split(".");e=1==i.length?$.Cmdbuild.dataModel.resolveInterfaceVariable(i[0]):"parameters"==i[0]?$.Cmdbuild.dataModel.resolveParametersVariable(i[1]):"window"==i[0]?$.Cmdbuild.dataModel.resolveWindowVariable(i[1]):"cmdbuildvariables"==i[0]?$.Cmdbuild.dataModel.resolveCMDBuildVariable(i[1]):$.Cmdbuild.dataModel.resolveModelVariable(i[0],i[1])}else e=t;return e},resolveVariables:function(t){var e={};for(var a in t)e[a]=$.Cmdbuild.dataModel.resolveVariable(t[a]);return e},detachObserving:function(){this.observing=!1},attachObserving:function(){this.observing=!0},detachedObserving:function(){return!this.observing},dispatchChange:function(t){if(!$.Cmdbuild.dataModel.detachedObserving())try{var e={};for(var a in $.Cmdbuild.dataModel.observers)for(var i=0;i<$.Cmdbuild.dataModel.observers[a].fields.length;i++){var r=$.Cmdbuild.dataModel.observers[a].fields[i].form;t==r&&(e[a]||(e[a]={},e[a].fields=[],e[a].container=$.Cmdbuild.dataModel.observers[a].container),e[a].fields.push({tag:$.Cmdbuild.dataModel.observers[a].fields[i].tag,variable:"$"+t+"."+$.Cmdbuild.dataModel.observers[a].fields[i].field}))}for(var n in e){var o={};o.form=n,o.container=e[n].container,o.fromObserving="true";for(var i=0;i<e[n].fields.length;i++)o[e[n].fields[i].tag]=e[n].fields[i].variable;$.Cmdbuild.standard.commands.navigate(o)}}catch(s){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.setObserver"),s}},setObserver:function(t){var e=[];try{for(var a in t.fields){if("$"!=(""+t.fields[a]).substr(0,1)){var i=$.Cmdbuild.errorsManager.getError({message:$.Cmdbuild.errorsManager.CMERROR,type:$.Cmdbuild.errorsManager.MALFORMEDVARIABLE,element:a,variable:t.fields[a]});throw i}var r=t.fields[a].substr(1),n=r.split(".");e.push({form:n[0],field:n[1],tag:a})}$.Cmdbuild.dataModel.observers[t.form]={},$.Cmdbuild.dataModel.observers[t.form].fields=e,$.Cmdbuild.dataModel.observers[t.form].container=t.container}catch(o){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.dataModel.setObserver"),o}},setAttachmentsForWidget:function(t,e){this.attachments[t]=e.slice()},addAttachmentForWidget:function(t,e){t in this.attachments||(this.attachments[t]=[]),this.attachments[t].push(e)},getAttachmentsForWidget:function(t){return t in this.attachments?this.attachments[t]:[]}};$.Cmdbuild.dataModel=dataModel}(jQuery),function(t){var e={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},a={getBaseUrlCard:function(){return t.Cmdbuild.guiJavaUrlKey+"services/gui/ldapmanager/"},postLdap:function(a,i,r){var n=this.getBaseUrlCard();t.Cmdbuild.authProxy.makeAjaxRequest(n,e.POST,function(t){i.apply(r,[t])},a)}};t.Cmdbuild.utilities.proxyGuiServerSide=a}(jQuery),function(t){var e={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},a={prepareParamsForList:function(t){var e={start:t.start?t.start:0};t.limit&&(e.limit=t.limit);var a=[];return t.sort&&(a.push({property:t.sort,direction:t.direction}),e.sort=JSON.stringify(a)),t.filter?e.filter=JSON.stringify(t.filter):e.filter="{query : ''}",t.active&&(e.active=t.active),t.positionOf&&(e.positionOf=t.positionOf),e},getURIForFileStoreItemDownload:function(e,a,i){return t.Cmdbuild.global.getApiUrl()+"filestores/"+e+"/folders/"+a+"/files/"+i+"/download?CMDBuild-Authorization="+t.Cmdbuild.authentication.getAuthenticationToken()},getAttachmentsCategories:function(a,i){var r=t.Cmdbuild.global.getApiUrl()+"configuration/attachments/categories";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t){a.apply(i,[t])})},getClassPrivileges:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"roles/"+a+"/classes_privileges/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getClassAttributes:function(a,i,r){var n=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(e){var a=[];t.each(e,function(t,e){e.active&&a.push(e)}),i.apply(r,[a])})},getFilteredCards:function(a,i,r){var n=this.prepareParamsForList(a),o=t.Cmdbuild.global.getApiUrl()+"classes";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){i.apply(r,[t,e])},n)},getCardList:function(a,i,r,n){var o=this.prepareParamsForList(i),s=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/cards";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){r.apply(n,[t,e])},o)},getRelations:function(a,i,r,n){var o=this.prepareParamsForList(i),s=t.Cmdbuild.global.getApiUrl()+"domains/"+a+"/relations/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){r.apply(n,[t,e])},o)},getRelation:function(a,i,r,n,o){var s=this.prepareParamsForList(r),l=t.Cmdbuild.global.getApiUrl()+"domains/"+a+"/relations/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){n.apply(o,[t,e])},s)},getDomains:function(a,i,r){var n=this.prepareParamsForList(a),o=t.Cmdbuild.global.getApiUrl()+"domains/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){i.apply(r,[t,e])},n)},getDomain:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"domains/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){i.apply(r,[t,e])},n)},getDomainAttributes:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"domains/"+a+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){i.apply(r,[t,e])},n)},getClass:function(a,i,r){var n={success:function(t,e){i.apply(r,[t,e])},fail:function(t){i.apply(r,[[],[]])}},o=t.Cmdbuild.global.getApiUrl()+"classes/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,n,{})},getClasses:function(a,i){var r=t.Cmdbuild.global.getApiUrl()+"classes/";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t,e){a.apply(i,[t,e])},{})},deleteCard:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/cards/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.DELETE,function(t,e){r.apply(n,[t,e])},{})},getCardData:function(a,i,r,n,o){var s=this.prepareParamsForList(r),l=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/cards/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){n.apply(o,[t,e])},s)},getCardAttachments:function(a,i,r,n,o){var s=this.prepareParamsForList(r),l=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/cards/"+i+"/attachments/";t.Cmdbuild.authProxy.makeAjaxRequest(l,e.GET,function(t,e){n.apply(o,[t,e])},s)},getLookupValue:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+a+"/values/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){n.apply(o,[t,e])},{})},getLookupType:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){r.apply(n,[t,e])},{})},getLookupData:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+a+"/values/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){r.apply(n,[t,e])},i)},getStepProcessAttributes:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/activities/"+r+"/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t){n.apply(o,[t])})},putProcessMail:function(a,i,r,n,o,s){var l=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/emails/"+r;t.Cmdbuild.authProxy.makeAjaxRequest(l,e.PUT,function(t){o.apply(s,[t])},JSON.stringify(n))},deleteProcessMail:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/emails/"+r;t.Cmdbuild.authProxy.makeAjaxRequest(s,e.DELETE,function(t){n.apply(o,[t])},{})},postProcessMail:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/emails/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.POST,function(t){n.apply(o,[t])},JSON.stringify(r))},getProcessMails:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/emails/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){r.apply(n,[t,e])},o)},getProcessSingleMail:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/emails/"+r+"/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t){n.apply(o,[t])})},getProcess:function(a,i,r){var n={success:function(t){i.apply(r,[t])},fail:function(t){i.apply(r,[[]])}},o=t.Cmdbuild.global.getApiUrl()+"processes/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,n)},getProcessAttributes:function(a,i,r){var n=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(e){var a=[];t.each(e,function(t,e){e.active&&a.push(e)}),i.apply(r,[a])})},getProcesses:function(a,i){var r=t.Cmdbuild.global.getApiUrl()+"processes/";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t){a.apply(i,[t])})},getProcessStatuses:function(a,i){var r=t.Cmdbuild.global.getApiUrl()+"configuration/processes/statuses/";t.Cmdbuild.authProxy.makeAjaxRequest(r,e.GET,function(t){a.apply(i,[t])})},getStartProcessAttributes:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/start_activities/"+i+"/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getStartProcessActivities:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/start_activities/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getCardProcess:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i;t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){n.apply(o,[t,e])})},getActivity:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/activities/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t){r.apply(n,[t])})},getActivityList:function(a,i,r,n){var o=this.prepareParamsForList(i),s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t,e){r.apply(n,[t,e])},o)},putSession:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"sessions/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.PUT,function(){},JSON.stringify(i))},getSession:function(a,i,r,n){n||(n=[]);var o=t.Cmdbuild.global.getApiUrl()+"sessions/"+a;t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){n.push([t,e]),i.apply(r,n)},{})},postNewCard:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/cards/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.POST,function(t){r.apply(n,[t])},JSON.stringify(i))},getSingleProcessInstance:function(a,i,r,n,o,s){var l=this.prepareParamsForList(r),d=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/";t.Cmdbuild.authProxy.makeAjaxRequest(d,e.GET,function(t){o.apply(s,callBackData,[t])},l)},abortProcess:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.DELETE,function(t){n.apply(o,[t])},JSON.stringify(r))},putStepProcess:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.PUT,function(t){n.apply(o,[t])},JSON.stringify(r))},postNewProcess:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.POST,function(t){r.apply(n,[t])},JSON.stringify(i))},postDomain:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"domains/"+a+"/relations/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.POST,function(t){r.apply(n,[t])},JSON.stringify(i))},putCard:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"classes/"+a+"/cards/"+i+"/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.PUT,function(t){n.apply(o,[t])},JSON.stringify(r))},putImpersonate:function(a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"sessions/"+a+"/impersonate/"+i+"/",s={success:function(t){r.apply(n,[!0])},fail:function(t){r.apply(n,[!1])}};t.Cmdbuild.authProxy.makeAjaxRequest(o,e.PUT,s)},getReports:function(a,i,r){var n=t.Cmdbuild.global.getApiUrl()+"reports/";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(t){i.apply(r,[t])})},getReportAttributes:function(a,i,r){var n=t.Cmdbuild.global.getApiUrl()+"reports/"+a+"/attributes";t.Cmdbuild.authProxy.makeAjaxRequest(n,e.GET,function(e){var a=[];t.each(e,function(t,e){e.active&&a.push(e)}),i.apply(r,[a])})},getInstanceAttachment:function(a,i,r,n,o){var s=t.Cmdbuild.global.getApiUrl()+"processes/"+a+"/instances/"+i+"/attachments/";t.Cmdbuild.authProxy.makeAjaxRequest(s,e.GET,function(t){n.apply(o,[t])})},postInstanceAttachment:function(e,a,i,r,n){var o=t.Cmdbuild.global.getApiUrl()+"processes/"+e+"/instances/"+a+"/attachments/",s={success:function(t,e){r.apply(n,[t,e])},fail:function(e){t.Cmdbuild.errorsManager.popup(new Error("The document is just saved")),r.apply(n,[e])}};t.Cmdbuild.authProxy.makeAjaxRequest(o,"POST",s,i,!0)},getCqlResults:function(a,i,r){var n=this.prepareParamsForList(a),o=t.Cmdbuild.global.getApiUrl()+"cql/",s=void 0;s="function"==typeof i?{success:function(t,e){i.apply(r,[t,e])},fail:function(t){i.apply(r,[[],[]])}}:i,t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,s,n)},getIcons:function(a,i,r){var n=this.prepareParamsForList(a),o=t.Cmdbuild.global.getApiUrl()+"icons/";t.Cmdbuild.authProxy.makeAjaxRequest(o,e.GET,function(t,e){i.apply(r,[t,e])},n)}};t.Cmdbuild.utilities.proxy=a}(jQuery),function(t){var e={arScripts:[],execute:function(){try{for(;this.arScripts.length>0;){var e=this.arScripts[0];this.arScripts.splice(0,1),this.executeScript(e)}}catch(a){throw t.Cmdbuild.errorsManager.log("$.Cmdbuild.scriptsManager.execute "+a.message,a.stack),a}},executeScript:function(e){if(t.Cmdbuild.custom.scripts&&t.Cmdbuild.custom.scripts[e.script])t.Cmdbuild.custom.scripts[e.script](e);else{if(!t.Cmdbuild.standard.scripts[e.script]){var a=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.SCRIPTNOTDEFINED,element:e.id,method:e.type});throw a}t.Cmdbuild.standard.scripts[e.script](e)}},push:function(t){this.arScripts.push(t)}};t.Cmdbuild.scriptsManager=e}(jQuery),function(t){function e(){var t=arguments[0],a=e.cache;return a[t]&&a.hasOwnProperty(t)||(a[t]=e.parse(t)),e.format.call(null,a[t],arguments)}function a(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function i(t,e){return Array(e+1).join(t)}var r={not_string:/[^s]/,number:/[dief]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fiosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};e.format=function(t,n){var o,s,l,d,u,c,m,p=1,g=t.length,f="",b=[],h=!0,C="";for(s=0;g>s;s++)if(f=a(t[s]),"string"===f)b[b.length]=t[s];else if("array"===f){if(d=t[s],d[2])for(o=n[p],l=0;l<d[2].length;l++){if(!o.hasOwnProperty(d[2][l]))throw new Error(e("[sprintf] property '%s' does not exist",d[2][l]));o=o[d[2][l]]}else o=d[1]?n[d[1]]:n[p++];if("function"==a(o)&&(o=o()),r.not_string.test(d[8])&&"number"!=a(o)&&isNaN(o))throw new TypeError(e("[sprintf] expecting number but found %s",a(o)));switch(r.number.test(d[8])&&(h=o>=0),d[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":case"i":o=parseInt(o,10);break;case"e":o=d[7]?o.toExponential(d[7]):o.toExponential();break;case"f":o=d[7]?parseFloat(o).toFixed(d[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&d[7]?o.substring(0,d[7]):o;break;case"u":o>>>=0;break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}!r.number.test(d[8])||h&&!d[3]?C="":(C=h?"+":"-",o=o.toString().replace(r.sign,"")),c=d[4]?"0"===d[4]?"0":d[4].charAt(1):" ",m=d[6]-(C+o).length,u=d[6]&&m>0?i(c,m):"",b[b.length]=d[5]?C+o+u:"0"===c?C+u+o:u+C+o}return b.join("")},e.cache={},e.parse=function(t){for(var e=t,a=[],i=[],n=0;e;){if(null!==(a=r.text.exec(e)))i[i.length]=a[0];else if(null!==(a=r.modulo.exec(e)))i[i.length]="%";else{if(null===(a=r.placeholder.exec(e)))throw new SyntaxError("[sprintf] unexpected placeholder");if(a[2]){n|=1;var o=[],s=a[2],l=[];if(null===(l=r.key.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o[o.length]=l[1];""!==(s=s.substring(l[0].length));)if(null!==(l=r.key_access.exec(s)))o[o.length]=l[1];else{if(null===(l=r.index_access.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");o[o.length]=l[1]}a[2]=o}else n|=2;if(3===n)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i[i.length]=a}e=e.substring(a[0].length)}return i};var n=function(t,a,i){return i=(a||[]).slice(0),i.splice(0,0,t),e.apply(null,i)};"undefined"!=typeof exports?(exports.sprintf=e,exports.vsprintf=n):(t.sprintf=e,t.vsprintf=n,"function"==typeof define&&define.amd&&define(function(){return{sprintf:e,vsprintf:n}}))}("undefined"==typeof window?this:window),function(t){var e={scriptsToLoad:["libraries/jquery-ui.js","libraries/jquery.dataTables.js","libraries/dataTables.jqueryui.js","libraries/dataTables.fixedColumns.min.js","libraries/js/jquery.validation.js","libraries/js/jstree.min.js","libraries/js/jstree-actions.js","libraries/js/waitMe.min.js","libraries/js/clEditor/jquery.cleditor.js","libraries/js/jquery-ui-timepicker-addon.js","core/errorsManager.js","core/global.js","core/model.js","core/errorsManager.js","core/loadingDialog.js","core/eventsManager.js","core/elementsManager.js","core/scriptsManager.js","core/utilities.js","core/ldap.js","core/proxy.js","core/proxyGuiServerSide.js","core/sprintf.js","core/authProxy.js","core/contextStack.js","core/authentication.js","core/translations.js","core/cookie.js","core/fieldsManager.js","cql/CqlManager.js","cql/Configurator.js","standard/backend/Card.js","standard/backend/Lookup.js","standard/backend/Select.js","standard/backend/Process.js","standard/backend/Activity.js","standard/backend/CardList.js","standard/backend/DomainList.js","standard/backend/NewActivity.js","standard/backend/DmsCategory.js","standard/backend/Attachements.js","standard/backend/ActivityHelp.js","standard/backend/ActivityList.js","standard/backend/HelpNewActivity.js","standard/backend/DomainListOnProcesses.js","standard/backend/ReferenceActivityList.js","standard/backend/Report.js","standard/backend/ProcessAttachments.js","standard/backend/Mail.js","standard/backend/MailList.js","standard/backend/DelayTable.js","standard/config.js","standard/form.js","standard/grid.js","standard/navigation.js","standard/tabbed.js","standard/div.js","standard/widgetDiv.js","standard/elements.js","standard/scripts.js","standard/commands.js","standard/popup.js","standard/lookupField.js","standard/graph.js","standard/selectField.js","standard/referenceField.js","standard/widgets/widgets.js","standard/widgets/LinkCards.js","standard/widgets/ManageEmail.js","standard/widgets/OpenAttachment.js"],stylesToLoad:["libraries/jquery-ui.css","libraries/jquery-ui.structure.css","libraries/dataTables.jqueryui.css","libraries/cmdbuild-gridlayout.css","libraries/dataTables.fixedColumns.min.css","libraries/css/cmdbuildstyle.css","libraries/css/waitMe.min.css","libraries/js/clEditor/jquery.cleditor.css","libraries/css/jstree.css","libraries/css/jquery-ui-timepicker-addon.css"],defaultTheme:"libraries/jquery-ui.theme.css",loadAndStart:function(e,a){this.configParams=e,this.htmlContainer=a;var i=this.getStatisScripts(),r=this.getCustomScripts(e.customjs),n=t.merge(i,r),o=0;this.loadScript(n,o),this.loadStaticStylesheets(),this.loadThemeStylesheet(e.theme),this.loadHttpCallParameters(this.configParams.httpCallParameters)},loadHttpCallParameters:function(t){this.httpCallParameters=t},loadScript:function(e,a){var i=this,r=e[a];t.ajax({async:!1,url:r,crossDomain:!0,dataType:"script",cache:!1,success:function(t,r){var n=a+1;n==e.length?i.onLoadCMDBuildLibraries():i.loadScript(e,n)}})},onLoadCMDBuildLibraries:function(){if("undefined"==typeof console){var e=function(){};console={log:e,info:e,warn:e,error:e,debug:e}}var a=function(t){},i=new Configurator(a);t.Cmdbuild.CqlManager=new CqlManager(i),t.Cmdbuild.customvariables={},t.Cmdbuild.global.setThemeCSSClass(this.configParams.cssClass),t.Cmdbuild.global.setApiUrl(t.Cmdbuild.apiUrl),t.Cmdbuild.global.setAppRootUrl(t.Cmdbuild.appRootUrl),t.Cmdbuild.global.setAppConfigUrl(t.Cmdbuild.appConfigUrl),t.Cmdbuild.global.setAuthenticationConfig(this.configParams.authentication),t.Cmdbuild.global.setLanguage(this.configParams.language),t.Cmdbuild.global.setHtmlContainer(this.htmlContainer);var r=t.Cmdbuild.appConfigUrl+this.configParams.start;t.Cmdbuild.global.setConfigurationDocument(r,this.onConfigurationReady)},onConfigurationReady:function(){t.Cmdbuild.translations.loadTranslations(function(){var e=t.Cmdbuild.authentication.getAuthenticationToken();e?t.Cmdbuild.utilities.startApplication():t.Cmdbuild.authentication.authenticate()},this)},getStatisScripts:function(){for(var e=[],a=this.scriptsToLoad,i=0;i<a.length;i++)e.push(t.Cmdbuild.appRootUrl+a[i]);return e},getCustomScripts:function(e){for(var a=[],i=t.Cmdbuild.appConfigUrl+"customjs/",r=0;r<e.length;r++)a.push(i+e[r]);return a},loadStylesheet:function(e){var a=t("<link rel='stylesheet' type='text/css' href='"+e+"'>");t("head").append(a)},loadStaticStylesheets:function(){for(var e=this,a=this.stylesToLoad,i=0;i<a.length;i++){var r=t.Cmdbuild.appRootUrl+a[i];e.loadStylesheet(r)}},loadThemeStylesheet:function(e){if(e){var a=t.Cmdbuild.appConfigUrl+"theme/";if(t.isArray(e))for(var i=0;i<e.length;i++)this.loadStylesheet(a+e[i]);else this.loadStylesheet(a+e)}else this.loadStylesheet(t.Cmdbuild.appRootUrl+this.defaultTheme)}};t.Cmdbuild.start=e}(jQuery),function(t){var e={translations:{},loadTranslations:function(e,a){var i=this,r={callback:e,callbackScope:a},n=t.Cmdbuild.global.getLanguage();if(!n)return t.Cmdbuild.errorsManager.warn("No language selected"),void e.apply(a,[]);var o=t.Cmdbuild.global.getAppConfigUrl()+"translations/"+n+".xml";t.ajax({type:"HEAD",url:o}).done(function(){t.Cmdbuild.utilities.getXmlDoc(o,i.loadTranslationsCB,i,r)}).fail(function(){e.apply(a,[]),t.Cmdbuild.errorsManager.warn("No translation file found for language "+n.toUpperCase())})},loadTranslationsCB:function(e,a){var i=e.documentElement,r=t(i),n=this;t.each(r.children(),function(t,e){n.translations[e.tagName]=e.textContent});var o=a.callback,s=a.callbackScope;o.apply(s,[])},getTranslations:function(){return this.translations},getTranslation:function(e,a){if(this.getTranslations()&&this.getTranslations()[e])return this.getTranslations()[e];var i=t.Cmdbuild.global.getLanguage();return i&&t.Cmdbuild.errorsManager.warn("No translation found for label "+e+" into "+i.toUpperCase()+" language file"),a?a:e}};t.Cmdbuild.translations=e}(jQuery),function(t){var e={getXmlDoc:function(e,a,i,r){t.support.cors=!0,t.ajax({type:"GET",url:e,data:{},cache:!1,dataType:"xml",crossDomain:!0}).done(function(t){a.call(i,t,r)}).fail(function(t,e,a){console.log(t,e,a)}).always(function(){})},getLookupIdFromCode:function(e,a,i,r){var n=t.Cmdbuild.global.getApiUrl()+"lookup_types/"+e+"/values/";t.Cmdbuild.authProxy.makeAjaxRequest(n,"GET",function(t,e){for(var n=0;n<t.length;n++)if(t[n].code==a){i.apply(r,[t[n]._id]);break}},{})},removeAllChildren:function(t){for(var e;e=t.lastChild;)t.removeChild(e)},include:function(e,a,i,r){var n="";if(n=e.getAttribute("include"),!n)return void a.apply(r,[i]);var o=e.getAttribute("withId"),s=e.getAttribute("fileType");this.removeAllChildren(e);var l="";l=s&&"core"===s?t.Cmdbuild.global.getAppRootUrl()+"templates/"+n:t.Cmdbuild.global.getAppConfigUrl()+n,this.getXmlDoc(l,this.includeCB,this,{withId:o,xmlElement:e,callback:a,callbackParams:i,callbackScope:r})},includeCB:function(e,a){var i=e.documentElement;if(a.withId){var r=this;t(i).find("*[id]").each(function(){r.updateElementIds(i,this,a.withId);
}),this.updateAttributeIds(i,a.withId)}for(var n=0;n<i.childNodes.length;n++)"#text"!=i.childNodes[n].nodeName&&"#comment"!=i.childNodes[n].nodeName&&a.xmlElement.appendChild(i.childNodes[n]);a.callback&&a.callback.apply(a.callbackScope,[a.callbackParams])},updateElementIds:function(e,a,i){var r=t(a).attr("id");t(a).attr("id",i+r);for(var n=0;n<t.Cmdbuild.global.ID_TAGS.length;n++){var o=t.Cmdbuild.global.ID_TAGS[n];t(e).find(o+":contains("+r+")").each(function(){var e=t(this).text();if("$"==e.substr(0,1)&&t.trim(e.substr(1))==r){t(this).text("$"+i+r);var a=e.split(".");a.length>1&&t(this).text(t(this).text()+a[1])}else if("$"==e.substr(0,1)){var a=e.split(".");t.trim(a[0].substr(1))==r&&a.length>1&&t(this).text("$"+i+r+"."+a[1])}else if(t.trim(e)==r)t(this).text(i+r);else{var a=e.split(".");a.length>1&&t.trim(a[n])==r&&t(this).text(a[0]+"."+i+r)}})}},updateAttributeIds:function(e,a){for(var i=0;i<t.Cmdbuild.global.ID_TAGSWITHVARIABLEATTRIBUTES.length;i++){var r=t.Cmdbuild.global.ID_TAGSWITHVARIABLEATTRIBUTES[i][0],n=t.Cmdbuild.global.ID_TAGSWITHVARIABLEATTRIBUTES[i][1];t(e).find(r).each(function(){var e=t(this).attr(n);t(this).attr(n,a+e)})}},getBackend:function(e){var a=t.Cmdbuild.utilities.getPathObject(e,t.Cmdbuild.custom.backend);if(a||(a=t.Cmdbuild.utilities.getPathObject(e,t.Cmdbuild.standard.backend)),!a){var i=t.Cmdbuild.errorsManager.getError({message:t.Cmdbuild.errorsManager.CMERROR,type:t.Cmdbuild.errorsManager.BACKENDMETHODNOTDEFINED,element:e});throw i}return a},getPathObject:function(t,e){if(!t)return null;for(var a=t.split("."),i=0;i<a.length;i++){if(!e[a[i]])return null;e=e[a[i]]}return e},formatVarString:function(){var t=[].slice.call(arguments);"[object Object]"!=this.toString()&&t.unshift(this.toString());var e=new RegExp("{([1-"+t.length+"])}","g");return String(t[0]).replace(e,function(e,a){return t[a]})},getFieldDescription:function(e,a,i,r){if("reference"==e.type)t.Cmdbuild.utilities.proxy.getCardData(e.targetClass,a,{},function(t,e){i.apply(r,[t.Description])},this);else if("lookup"==e.type)t.Cmdbuild.utilities.proxy.getLookupValue(e.lookupType,a,{},function(t,e){i.apply(r,[t.description])},this);else if("decimal"==e.type)try{i.apply(r,[a.toFixed(e.scale)])}catch(n){i.apply(r,[void 0])}else i.apply(r,[void 0])},getHtmlFieldValue:function(e){var a=t(e);if(a){if("SELECT"==a.prop("tagName")){var i=a.val();return i}if(a.attr("isDate")){var i=a.val(),r=a.attr("date-input-type");return i=t.Cmdbuild.utilities.convertDateGUI2DB(i,r)}if("spinner"==a.attr("valueType")){var i=a.spinner("value");return i}return"checkbox"==a.attr("type")?a.prop("checked")?!0:!1:a.val()}return null},convertDateGUI2DB:function(t,e){if("date"==e){var a=t.split("/");return 3==a.length?t=a[2]+"-"+a[1]+"-"+a[0]+"T00:00:00":""}if("time"==e)return"1970-01-01T"+t;if("dateTime"==e){var i=t.split(" ");return 2===i.length?(a=i[0].split("/"),t=a[2]+"-"+a[1]+"-"+a[0]+"T"+i[1]):t.replace("/","-")}return t},convertDateDB2GUI:function(t,e){if(!t)return"";if("date"==e){var a=t.split("T");return a=a[0].split("-"),3==a.length&&(t=a[2]+"/"+a[1]+"/"+a[0]),t}if("time"==e){var a=t.split("T");return a[1]}return"dateTime"==e?this.convertDateDB2GUI(t,"date")+" "+this.convertDateDB2GUI(t,"time"):t},getHtmlFieldInteractivity:function(e){var a=t(e);return a&&a.attr("interactivity")?a.attr("interactivity"):null},setAttributesInteractivity:function(e){for(var a=0;a<e.length;a++)e[a].interactivity=t.Cmdbuild.global.fieldInteractivityFromCard(e[a].isnotnull)},currentMenu:function(e,a){t("#"+a+" .ui-menu-item.selected").removeClass("selected"),t("#"+e).addClass("selected")},getEventLikeString:function(e,a,i){var r="";otherCommand=""|i;var n=t.Cmdbuild.elementsManager.getEvent(a,e);return n?r=" "+a+"='$.Cmdbuild.eventsManager.onEvent("+JSON.stringify(n)+");"+i+"' ":""},clone:function(t){return JSON.parse(JSON.stringify(t))},escapeHtml:function(t){if(!t)return"";var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","/":"/"},a=String(t).replace(/[&<>"'\/]/g,function(t){return e[t]});return a},removeAttribute:function(t,e){for(var a=0;a<t.length;a++)if(t[a].name==e){t.splice(a,1);break}return t},changeAttributeType:function(t,e,a){for(var i=0;i<t.length;i++)if(t[i].name==e){t[i].type=a;break}return t},sortAttributes:function(t){t.sort(function(t,e){return t.index-e.index})},insertOtherGroup:function(t,e){for(var a=!1,i=0;i<t.length;i++)if(t[i].group){a=!0;break}if(a)for(var i=0;i<t.length;i++)t[i].group||(t[i].group="Others");return t},startApplication:function(){var e=this;t.Cmdbuild.utilities.proxy.getClasses(function(a){t.Cmdbuild.dataModel.setClasses(a),t.Cmdbuild.utilities.proxy.getProcesses(function(a){t.Cmdbuild.dataModel.setProcesses(a),t.Cmdbuild.custom.commands&&t.Cmdbuild.custom.commands.initialize?t.Cmdbuild.custom.commands.initialize(e.startApplicationCallBack):e.startApplicationCallBack()},e)},e)},startApplicationCallBack:function(){t.Cmdbuild.global.getHtmlContainer().innerHTML="";var e=t.Cmdbuild.global.getConfigurationDocument().documentElement,a=t.Cmdbuild.elementsManager.insertDialog("errorDialog",t.Cmdbuild.errorsManager.close);a+=t.Cmdbuild.elementsManager.insertChildren(e),t(t.Cmdbuild.global.getHtmlContainer()).attr("class",t.Cmdbuild.global.getThemeCSSClass()),t.Cmdbuild.global.getHtmlContainer().innerHTML=a,t.Cmdbuild.elementsManager.initialize(),t(document).tooltip()},getFields:function(e){var a=t(e),i=a.find("fields");if(i.length){var r={},n=t(i[0]),o=n.children("form").text();r.form=o;var s=n.children("method").text();if(r.method=s,0==n.children("field").length)return r;r.fields={};for(var l=0;l<n.children("field").length;l++){var d=t(n.children("field")[l]),u=d.children("name").text(),c={};if(u){for(var m=d.children("attributes"),p=0;p<m.children("attribute").length;p++){var g=t(m.children("attribute")[p]),f=g.children("name").text(),b=g.children("value").text();f&&(c[f]=b)}r.fields[u]=c}}return r}},getFormFields:function(e){var a=t(e),i=a.find("formFields");if(i.length){var r={},n=t(i[0]),o=n.children("form").text();if(r.form=o,0==n.children("field").length)return r;r.fields={};for(var s=0;s<n.children("field").length;s++){var l=t(n.children("field")[s]),d=l.children("name").text(),u={};if(d){for(var c=l.children("attributes"),m=0;m<c.children("attribute").length;m++){var p=t(c.children("attribute")[m]),g=p.children("name").text(),f=p.children("value").text();g&&(u[g]=f)}r.fields[d]=u}}return r}},addFields:function(){},getToday:function(){var t=new Date,e=t.getDate(),a=t.getMonth()+1,i=t.getFullYear();return e+"/"+a+"/"+i},getConditionsFromParam:function(e){var a=[];if(e.condition)for(var i=e.condition.split(","),r=0;r<i.length;r++){var n=i[r].split("="),o={field:n[0],value:t.Cmdbuild.dataModel.resolveVariable(n[1])};a.push(o)}return a},getAttributesFilterFromConditions:function(t){if(0!=t.length){for(var e={},a=[],i=0;i<t.length;i++){var r={simple:{attribute:t[i].field,operator:"equal",value:[t[i].value],parameterType:"fixed"}};a.push(r)}return e=1==t.length?a[0]:{and:a}}},getWidgetsFromXML:function(e){var a=[],i=t(e),r=i.children("widgets");return r.length&&0!=r.children("widget").length?(t.each(r.children("widget"),function(e,i){var r={};t.each(i.children,function(t,e){r[e.nodeName]=e.textContent}),a.push({_id:r.id,active:r.active,label:r.label,required:r.required,type:r.type,data:r})}),a):void 0},getButtonsFromXML:function(e){var a="",i=t(e),r=i.children("buttons"),n=r.length>0&&r.children("button").length>0;return n&&(a+='<div class="formButtons">'),t.each(r.children("button"),function(e,i){var r=new DOMParser;xDoc=r.parseFromString(i.outerHTML,"text/xml"),a+=t.Cmdbuild.elementsManager.toHtml(xDoc.documentElement)}),n&&(a+="</div>"),a},popupMessage:function(e,a){t("<div />").html(a).dialog({title:e,dialogClass:"no-close",dialogClass:t.Cmdbuild.global.getThemeCSSClass(),buttons:[{text:"OK",click:function(){t(this).dialog("destroy")}}]})},uniqueId:function(){return Math.round((new Date).getTime()+100*Math.random())},readCookie:function(t){for(var e=t+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var r=a[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return null},attributesSorter:function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}};t.Cmdbuild.utilities=t.extend(t.Cmdbuild.utilities,e)}(jQuery);
//# sourceMappingURL=core.min.js.map